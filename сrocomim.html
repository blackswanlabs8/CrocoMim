<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–ö—Ä–æ–∫–æ–ú–∏–º</title>
  <style>
    :root{
      --accent:#22c55e;
      --accent-2:#16a34a;
      --accent-soft:rgba(34,197,94,.16);
      --danger:#ef4444;
      --warning:#f59e0b;
      --radius:18px;
    }
    body.theme-light{
      --bg:#eef2ff;
      --bg-overlay:radial-gradient(1200px 800px at 10% -10%, rgba(148,163,184,.32) 0%, transparent 60%),
                    radial-gradient(1300px 900px at 110% 10%, rgba(148,163,184,.24) 0%, transparent 55%);
      --app-bg:rgba(255,255,255,.92);
      --app-border:rgba(148,163,184,.25);
      --panel:#ffffff;
      --panel-2:#f5f7ff;
      --panel-soft:#edf2ff;
      --panel-border:rgba(148,163,184,.35);
      --panel-hover:rgba(148,163,184,.25);
      --text:#0f172a;
      --text-strong:#020617;
      --muted:#475569;
      --chip-bg:#f1f5f9;
      --chip-border:rgba(148,163,184,.45);
      --ghost-bg:#e2e8f0;
      --ghost-border:rgba(148,163,184,.55);
      --ghost-color:#0f172a;
      --shadow:0 18px 40px rgba(15,23,42,.12);
      --card:#ffffff;
      --thumb-border:rgba(15,23,42,.2);
      --thumb-shadow:rgba(34,197,94,.25);
    }
    body.theme-dark{
      --bg:#0f172a;
      --bg-overlay:radial-gradient(1200px 800px at 10% -10%, #11203d 0%, transparent 60%),
                    radial-gradient(1300px 900px at 110% 10%, #082631 0%, transparent 55%);
      --app-bg:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)) , rgba(12,18,34,.65);
      --app-border:rgba(255,255,255,.06);
      --panel:#111827;
      --panel-2:#1f2937;
      --panel-soft:rgba(15,23,42,.35);
      --panel-border:rgba(255,255,255,.06);
      --panel-hover:#263141;
      --text:#e5e7eb;
      --text-strong:#f8fafc;
      --muted:#94a3b8;
      --chip-bg:#22304a;
      --chip-border:rgba(255,255,255,.06);
      --ghost-bg:rgba(255,255,255,.02);
      --ghost-border:rgba(255,255,255,.08);
      --ghost-color:#e5e7eb;
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --card:#0b1223;
      --thumb-border:rgba(255,255,255,.35);
      --thumb-shadow:rgba(34,197,94,.45);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:var(--bg);
      background-image:var(--bg-overlay);
      background-repeat:no-repeat;
      background-attachment:fixed;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Noto Color Emoji;
      line-height:1.5;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .app{
      width:min(960px, 96vw);
      min-height:88vh;
      backdrop-filter:saturate(120%) blur(8px);
      background:var(--app-bg);
      border:1px solid var(--app-border);
      border-radius:24px;
      box-shadow:var(--shadow);
      padding:20px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    /* Header */
    .header{
      display:grid;
      grid-template-columns:48px 1fr 48px;
      align-items:center;
    }
    .icon-btn{
      width:40px;height:40px;border-radius:12px;
      display:flex;align-items:center;justify-content:center;
      background:var(--panel-2);
      border:1px solid var(--panel-border);
      color:var(--text);
      cursor:pointer;
      transition:transform .1s ease, background .2s ease, border .2s ease;
      user-select:none;
    }
    .icon-btn:hover{ background:var(--panel-hover); }
    .icon-btn:active{ transform:scale(.96) }
    .title{
      text-align:center;
      font-weight:800;
      letter-spacing:.4px;
      color:var(--text-strong);
      font-size:clamp(20px, 3vw, 28px);
    }

    /* Sections & cards */
    .section{
      background:var(--panel);
      border:1px solid var(--panel-border);
      border-radius:var(--radius);
      padding:16px;
    }
    .section h2{
      margin:0 0 12px 0;
      font-size:18px;color:var(--text-strong);font-weight:700;
    }
    .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center }
    .stack{ display:flex; flex-direction:column; gap:12px }
    .grow{ flex:1 1 0 }
    .mode-row{ display:grid; gap:12px; grid-template-columns:repeat(2, minmax(0,1fr)); }
    .mode-btn{
      display:flex; flex-direction:column; align-items:center; justify-content:center;
      gap:6px; padding:26px 14px; border-radius:18px;
      min-height:110px;
      background:var(--panel-2);
      border:1px solid var(--panel-border);
      color:var(--text);
      font-weight:700;
      cursor:pointer;
      transition:transform .1s ease, background .2s ease, border .2s ease;
    }
    .mode-btn .mode-icon{ font-size:28px; }
    .mode-btn:hover{ background:var(--panel-hover); }
    .mode-btn:active{ transform:scale(.97); }
    .mode-btn.active{ background:var(--accent-soft); border-color:var(--accent); color:var(--text-strong); }
    .menu-block{ background:var(--panel-soft); border:1px solid var(--panel-border); border-radius:16px; padding:14px; display:flex; flex-direction:column; gap:12px; }
    .menu-block-title{ font-weight:700; color:var(--text-strong); font-size:16px; }

    .theme-section{ display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap; }
    .theme-switch{ display:flex; align-items:center; gap:16px; width:100%; flex-wrap:wrap; }
    .theme-switch-label{ font-weight:700; color:var(--text-strong); font-size:16px; flex:0 0 auto; }
    .theme-slider{ display:flex; align-items:center; gap:10px; flex:0 0 auto; }
    .theme-slider span{ font-size:18px; }
    .theme-slider input[type="range"]{
      width:72px;
      height:6px;
      border-radius:999px;
      background:var(--panel-border);
      outline:none;
      -webkit-appearance:none;
    }
    .theme-slider input[type="range"]::-webkit-slider-runnable-track{
      height:6px;
      border-radius:999px;
      background:var(--panel-border);
    }
    .theme-slider input[type="range"]::-webkit-slider-thumb{
      -webkit-appearance:none;
      width:24px;
      height:24px;
      border-radius:50%;
      background:var(--accent);
      border:2px solid var(--thumb-border);
      box-shadow:0 4px 12px var(--thumb-shadow);
      margin-top:-9px;
      cursor:pointer;
    }
    .theme-slider input[type="range"]::-moz-range-track{
      height:6px;
      border-radius:999px;
      background:var(--panel-border);
    }
    .theme-slider input[type="range"]::-moz-range-thumb{
      width:24px;
      height:24px;
      border-radius:50%;
      background:var(--accent);
      border:2px solid var(--thumb-border);
      box-shadow:0 4px 12px var(--thumb-shadow);
      cursor:pointer;
    }

    /* Buttons */
    .btn{
      background:var(--accent);
      color:#03240f;
      font-weight:700;
      padding:12px 16px;
      border:none;border-radius:14px;
      cursor:pointer;
      box-shadow:0 6px 16px rgba(34,197,94,.25);
      transition:transform .08s ease, box-shadow .2s ease, background .2s ease;
      user-select:none;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
    }
    .btn:hover{ background:var(--accent-2) }
    .btn:active{ transform:translateY(1px) }
    .btn:disabled{
      opacity:.5;
      cursor:not-allowed;
      box-shadow:none;
      transform:none;
    }
    .btn.ghost{
      background:var(--ghost-bg);
      color:var(--ghost-color);
      border:1px solid var(--ghost-border);
      box-shadow:none;
    }
    .btn.warn{ background:var(--warning); color:#211a05 }
    .btn.danger{ background:var(--danger); color:#280707 }

    /* Inputs */
    .select,.input{
      min-height:44px;
      padding:10px 12px;
      border-radius:12px;
      background:var(--panel-2);
      color:var(--text);
      border:1px solid var(--panel-border);
      outline:none;
    }
    .select{ width:100% }
    .chip{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:8px 12px;
      border-radius:999px;
      background:var(--chip-bg);
      border:1px solid var(--chip-border);
      color:var(--text);
    }
    .chip input[type="checkbox"]{ margin-right:6px; accent-color:var(--accent); }
    .chip.check-only{
      width:44px;
      height:44px;
      padding:0;
      display:grid;
      place-items:center;
    }
    .chip.check-only input[type="checkbox"]{
      margin-right:0;
      width:20px;
      height:20px;
      margin:0;
    }
    .pts-controls{
      display:flex;
      align-items:center;
      gap:12px;
    }

    /* Word card */
    .word-card{
      background:linear-gradient(180deg, rgba(255,255,255,.18), rgba(255,255,255,.05)), var(--card);
      border:1px solid var(--panel-border);
      border-radius:22px;
      padding:36px 24px;
      min-height:220px;
      display:flex;
      align-items:center;
      justify-content:center;
      text-align:center;
      box-shadow:var(--shadow);
    }
    .word{
      font-size:clamp(36px, 8vw, 64px);
      font-weight:800;
      letter-spacing:.5px;
      color:var(--text-strong);
      word-break:break-word;
    }
    .muted{ color:var(--muted); font-size:14px }
    .kbd{ background:var(--panel-2);border:1px solid var(--panel-border);border-radius:6px;padding:2px 6px;font-family:ui-monospace, SFMono-Regular, Menlo, monospace; color:var(--text); }

    .grid-3{
      display:grid; gap:10px;
      grid-template-columns:repeat(3, minmax(0,1fr));
    }
    .btn-full{ width:100%; display:flex; justify-content:center; }
    .team-grid{
      display:grid;
      gap:10px;
      grid-template-columns:repeat(auto-fit, minmax(90px, 1fr));
    }
    .team-actions{
      justify-content:center;
      gap:12px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    .team-card{
      padding:10px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:8px;
      text-align:center;
    }
    .team-card-top{
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
    }
    .team-avatar{
      width:64px;
      height:64px;
      border-radius:20px;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:28px;
      background-size:cover;
      background-position:center;
      color:#0b0b0b;
      box-shadow:0 6px 16px rgba(15,23,42,.35);
      flex:0 0 auto;
      pointer-events:none;
    }
    .team-avatar span{ filter:drop-shadow(0 2px 4px rgba(0,0,0,.45)); }
    .team-body{
      width:100%;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:6px;
    }
    .team-name{
      font-size:14px;
      font-weight:700;
      color:var(--text-strong);
      text-align:center;
      word-break:break-word;
    }
    .team-delete{
      width:32px;
      height:32px;
      border-radius:12px;
      border:1px solid rgba(239,68,68,.35);
      background:rgba(239,68,68,.18);
      color:#fecaca;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      transition:background .2s ease, transform .1s ease;
    }
    .team-delete:hover{ background:rgba(239,68,68,.28); }
    .team-delete:active{ transform:scale(.95); }
    .team-chip{ display:flex; align-items:center; gap:8px; }
    .team-chip-icon{ font-size:20px; line-height:1; }
    #turnTeamName{ display:inline-flex; align-items:center; gap:6px; }
    .round-status{
      text-align:center;
      font-weight:600;
      color:var(--muted);
    }
    .chip input[type="checkbox"]{ margin-right:6px; accent-color:var(--accent); }
    .footer{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
      margin-top:auto;
    }
    .footer .btn-full{ flex:1 1 100%; }
    @media (max-width:600px){
      .grid-3{ grid-template-columns:1fr }
      .header{ grid-template-columns:44px 1fr 44px }
      .mode-row{ grid-template-columns:1fr }
    }
  </style>
</head>
<body class="theme-light">
<div class="app" id="app">

  <!-- HEADER -->
  <div class="header">
    <div class="icon-btn" id="btnBack" title="–ù–∞–∑–∞–¥ –≤ –º–µ–Ω—é" aria-label="–ù–∞–∑–∞–¥">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M15 6L9 12L15 18" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
    </div>
    <div class="title">–ö—Ä–æ–∫–æ–ú–∏–º</div>
    <div class="icon-btn" id="btnHelp" title="–°–ø—Ä–∞–≤–∫–∞" aria-label="–°–ø—Ä–∞–≤–∫–∞">
      <svg width="22" height="22" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10s10-4.477 10-10S17.523 2 12 2Zm0 14.25a1.25 1.25 0 1 1 0 2.5a1.25 1.25 0 0 1 0-2.5Zm0-10a3.25 3.25 0 0 1 3.25 3.25c0 1.35-.79 2.3-1.74 3.02c-.81.6-1.26 1.03-1.26 1.98v.25a1 1 0 1 1-2 0v-.25c0-1.62.85-2.47 1.69-3.1c.85-.64 1.31-1.06 1.31-1.9A1.25 1.25 0 0 0 12 7.25a1.25 1.25 0 0 0-1.25 1.25a1 1 0 1 1-2 0A3.25 3.25 0 0 1 12 6.25Z" fill="currentColor"/>
      </svg>
    </div>
  </div>

  <div class="section theme-section" id="themeSection">
    <div class="theme-switch">
      <div class="theme-switch-label">–¢–µ–º–∞</div>
      <div class="theme-slider">
        <span aria-hidden="true">üåû</span>
        <input type="range" id="themeSlider" min="0" max="1" step="1" value="0" aria-label="–ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã">
        <span aria-hidden="true">üåô</span>
      </div>
    </div>
  </div>

  <!-- MAIN VIEWS -->
  <div id="viewMenu" class="stack">
    <div class="section stack" style="gap:20px">
      <h2>–í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º –∏–≥—Ä—ã</h2>
      <div class="mode-row">
        <button class="mode-btn active" id="modeQuick" type="button">
          <span class="mode-icon">‚ö°</span>
          –ë—ã—Å—Ç—Ä—ã–π
        </button>
        <button class="mode-btn" id="goTeam" type="button">
          <span class="mode-icon">üë•</span>
          –ö–æ–º–∞–Ω–¥–∞
        </button>
      </div>

      <div class="stack" style="gap:16px">
        <div class="menu-block">
          <div class="menu-block-title">–°–ª–æ–≤–∞—Ä—å</div>
          <select class="select" id="quickDict">
            <option value="easy">–õ—ë–≥–∫–∏–π</option>
            <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
            <option value="hard">–°–ª–æ–∂–Ω—ã–π</option>
            <option value="films_series">–§–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã</option>
            <option value="geography">–ì–µ–æ–≥—Ä–∞—Ñ–∏—è</option>
            <option value="kids">–î–µ—Ç—Å–∫–∏–π</option>
            <option value="custom">–°–≤–æ–π —Å–ª–æ–≤–∞—Ä—å</option>
          </select>
          <div id="quickCustomBox" class="stack" style="display:none; margin-top:10px">
            <label class="muted">–í—Å—Ç–∞–≤—å—Ç–µ —Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏</label>
            <textarea class="input" id="quickCustomWords" rows="4" placeholder="—è–±–ª–æ–∫–æ, –∫–æ—Ä–∞–±–ª—å, —Ä–∞–¥—É–≥–∞..."></textarea>
          </div>
        </div>

        <div class="menu-block">
          <div class="menu-block-title">–¢–∞–π–º–µ—Ä</div>
          <div class="row" style="gap:12px; align-items:center; flex-wrap:nowrap; overflow-x:auto">
            <label class="chip check-only" title="–¢–∞–π–º–µ—Ä">
              <input type="checkbox" id="quickTimerToggle" aria-label="–í–∫–ª—é—á–∏—Ç—å —Ç–∞–π–º–µ—Ä">
            </label>
            <button class="btn ghost" id="quickTimeMinus" title="‚àí30 —Å–µ–∫—É–Ω–¥">‚àí</button>
            <div class="chip" id="quickTimeLabel">60 —Å</div>
            <button class="btn ghost" id="quickTimePlus" title="+30 —Å–µ–∫—É–Ω–¥">+</button>
          </div>
          <div class="muted" style="margin-top:8px">–®–∞–≥ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏: <span class="kbd">30—Å</span></div>
        </div>

        <div class="menu-block">
          <div class="menu-block-title">–û—á–∫–∏ –¥–æ –ø–æ–±–µ–¥—ã</div>
          <div class="row" style="gap:12px; align-items:center; flex-wrap:nowrap; overflow-x:auto">
            <label class="chip check-only" title="–û—á–∫–∏ –¥–æ –ø–æ–±–µ–¥—ã">
              <input type="checkbox" id="quickPtsToggle" aria-label="–í–∫–ª—é—á–∏—Ç—å –æ—á–∫–∏ –¥–æ –ø–æ–±–µ–¥—ã">
            </label>
            <div class="pts-controls" id="quickPtsControls" style="display:none">
              <button class="btn ghost" id="quickPtsMinus" title="–ú–∏–Ω—É—Å –æ–¥–Ω–æ –æ—á–∫–æ">‚àí</button>
              <div class="chip" id="quickPtsLabel">10</div>
              <button class="btn ghost" id="quickPtsPlus" title="–ü–ª—é—Å –æ–¥–Ω–æ –æ—á–∫–æ">+</button>
            </div>
          </div>
        </div>
      </div>

      <div class="footer">
        <button class="btn btn-full" id="startQuick">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
      </div>
    </div>
  </div>

  <!-- QUICK GAME -->
  <div id="viewQuickGame" class="stack" style="display:none">
    <div class="section row" style="justify-content:space-between; align-items:center">
      <div class="row" style="gap:10px; flex-wrap:wrap">
        <div class="chip">–£–≥–∞–¥–∞–Ω–æ: <span id="qHit">0</span></div>
        <div class="chip">–ü—Ä–æ–ø—É—â–µ–Ω–æ: <span id="qMiss">0</span></div>
        <div class="chip" id="qTimerBox" style="display:none">‚è± <span id="qTimer">00:00</span></div>
      </div>
      <button class="btn ghost" id="qStatsBtn" type="button">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
    </div>

    <div class="word-card">
      <div id="qWord" class="word">‚Äî</div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –ø–æ–¥ —Å–ª–æ–≤–æ–º –≤ 2 —Å—Ç—Ä–æ–∫–∏ –ø–æ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—é -->
    <div class="section">
      <div class="grid-3">
        <button class="btn ghost" id="qNext">–°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ</button>
        <button class="btn" id="qHitBtn">–£–≥–∞–¥–∞–Ω–æ</button>
        <button class="btn warn" id="qSkipBtn">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
      </div>
      <div class="stack" style="margin-top:10px">
        <button class="btn ghost" id="qHideBtn">–°–∫—Ä—ã—Ç—å —Å–ª–æ–≤–æ</button>
        <button class="btn ghost" id="qMeaningBtn">–ó–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ–≤–∞ (–í–∏–∫–∏–ø–µ–¥–∏—è)</button>
      </div>
    </div>
  </div>

  <!-- TEAM SETTINGS -->
  <div id="viewTeamSetup" class="stack" style="display:none">
    <div class="section">
      <h2>–ö–æ–º–∞–Ω–¥—ã</h2>
      <div id="teamList" class="team-grid"></div>
      <div class="row team-actions">
        <button class="btn ghost" id="teamAdd">+ –î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–∞–Ω–¥—É</button>
        <button class="btn ghost" id="teamRename">‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏—è</button>
      </div>
    </div>

    <div class="section">
      <h2>–°–ª–æ–≤–∞—Ä—å</h2>
      <select class="select" id="teamDict">
        <option value="easy">–õ—ë–≥–∫–∏–π</option>
        <option value="medium">–°—Ä–µ–¥–Ω–∏–π</option>
        <option value="hard">–°–ª–æ–∂–Ω—ã–π</option>
        <option value="films_series">–§–∏–ª—å–º—ã –∏ —Å–µ—Ä–∏–∞–ª—ã</option>
        <option value="geography">–ì–µ–æ–≥—Ä–∞—Ñ–∏—è</option>
        <option value="kids">–î–µ—Ç—Å–∫–∏–π</option>
        <option value="custom">–°–≤–æ–π —Å–ª–æ–≤–∞—Ä—å</option>
      </select>
      <div id="teamCustomBox" class="stack" style="display:none; margin-top:10px">
        <label class="muted">–í—Å—Ç–∞–≤—å—Ç–µ —Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é –∏–ª–∏ –ø–µ—Ä–µ–Ω–æ—Å —Å—Ç—Ä–æ–∫–∏</label>
        <textarea class="input" id="teamCustomWords" rows="4" placeholder="—è–±–ª–æ–∫–æ, –∫–æ—Ä–∞–±–ª—å, —Ä–∞–¥—É–≥–∞..."></textarea>
      </div>
    </div>

    <div class="section">
      <h2>–¢–∞–π–º–µ—Ä</h2>
      <div class="row" style="gap:12px; align-items:center; flex-wrap:nowrap; overflow-x:auto">
        <label class="chip check-only" title="–¢–∞–π–º–µ—Ä">
          <input type="checkbox" id="teamTimerToggle" aria-label="–í–∫–ª—é—á–∏—Ç—å —Ç–∞–π–º–µ—Ä">
        </label>
        <button class="btn ghost" id="teamTimeMinus" title="‚àí30 —Å–µ–∫—É–Ω–¥">‚àí</button>
        <div class="chip" id="teamTimeLabel">60 —Å</div>
        <button class="btn ghost" id="teamTimePlus" title="+30 —Å–µ–∫—É–Ω–¥">+</button>
      </div>
    </div>

    <div class="section">
      <h2>–û—á–∫–∏ –¥–æ –ø–æ–±–µ–¥—ã</h2>
      <div class="row" style="gap:12px; align-items:center; flex-wrap:nowrap; overflow-x:auto">
        <label class="chip check-only" title="–û—á–∫–∏ –¥–æ –ø–æ–±–µ–¥—ã">
          <input type="checkbox" id="teamPtsToggle" checked aria-label="–í–∫–ª—é—á–∏—Ç—å –æ—á–∫–∏ –¥–æ –ø–æ–±–µ–¥—ã">
        </label>
        <div class="pts-controls" id="ptsControls">
          <button class="btn ghost" id="ptsMinus" title="–ú–∏–Ω—É—Å –æ–¥–Ω–æ –æ—á–∫–æ">‚àí</button>
          <div class="chip" id="ptsLabel">10</div>
          <button class="btn ghost" id="ptsPlus" title="–ü–ª—é—Å –æ–¥–Ω–æ –æ—á–∫–æ">+</button>
        </div>
      </div>
    </div>

    <div class="footer">
      <button class="btn btn-full" id="startTeam">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>
  </div>

  <!-- TEAM GAME -->
  <div id="viewTeamGame" class="stack" style="display:none">
    <div class="section">
      <div class="row" style="justify-content:space-between; align-items:center">
        <div class="chip">–•–æ–¥: <strong id="turnTeamName">–ö–æ–º–∞–Ω–¥–∞ 1</strong></div>
        <div class="chip" id="tTimerBox" style="display:none">‚è± <span id="tTimer">00:00</span></div>
      </div>
    </div>

    <div class="word-card">
      <div id="tWord" class="word">‚Äî</div>
    </div>

    <div class="section stack" style="gap:12px; align-items:stretch">
      <div class="round-status" id="tRoundStatus">‚Äî</div>
      <div class="stack" style="gap:12px">
        <button class="btn btn-full" id="tStartRound">–ù–∞—á–∞—Ç—å —Ä–∞—É–Ω–¥</button>
        <button class="btn warn" id="tEndRound" style="display:none">–ó–∞–∫–æ–Ω—á–∏—Ç—å</button>
      </div>
    </div>

    <div class="section">
      <div class="grid-3">
        <button class="btn ghost" id="tNext">–°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ</button>
        <button class="btn" id="tHitBtn">–£–≥–∞–¥–∞–Ω–æ</button>
        <button class="btn warn" id="tSkipBtn">–ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å</button>
      </div>
      <div class="stack" style="margin-top:10px">
        <button class="btn ghost" id="tHideBtn">–°–∫—Ä—ã—Ç—å —Å–ª–æ–≤–æ</button>
        <button class="btn ghost" id="tMeaningBtn">–ó–Ω–∞—á–µ–Ω–∏–µ —Å–ª–æ–≤–∞ (–í–∏–∫–∏–ø–µ–¥–∏—è)</button>
      </div>
    </div>

    <div class="section stack" style="gap:12px">
      <button class="btn ghost btn-full" id="tStatsBtn" type="button">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
      <div id="scoreTable" class="stack"></div>
    </div>
  </div>

  <!-- FOOTER (–æ–ø—Ü.) -->
  <div class="footer" id="globalFooter" style="display:none"></div>
</div>

<script>
  // --- Utilities & state ---
  const $ = sel => document.querySelector(sel);
  let screen = 'menu';
  let qTimerId = null;
  let tTimerId = null;
  const backBtn = $('#btnBack');
  const helpBtn = $('#btnHelp');
  const modeQuickBtn = $('#modeQuick');
  const themeSlider = $('#themeSlider');
  const themeSection = $('#themeSection');
  const bodyEl = document.body;
  const THEME_KEY = 'croc-theme';

  const applyTheme = mode => {
    const themeClass = mode === 'dark' ? 'theme-dark' : 'theme-light';
    bodyEl.classList.remove('theme-light','theme-dark');
    bodyEl.classList.add(themeClass);
    if (themeSlider) themeSlider.value = mode === 'dark' ? '1' : '0';
  };
  const readThemePref = () => {
    try{ return localStorage.getItem(THEME_KEY); }
    catch{ return null; }
  };
  const writeThemePref = mode => {
    try{ localStorage.setItem(THEME_KEY, mode); }
    catch{}
  };
  const initialTheme = readThemePref();
  applyTheme(initialTheme === 'dark' ? 'dark' : 'light');
  if (themeSlider){
    themeSlider.addEventListener('input', e => {
      const mode = e.target.value === '1' ? 'dark' : 'light';
      applyTheme(mode);
      writeThemePref(mode);
    });
  }

  const DICTS = {
    easy:["–¥–æ–º","–∫–æ—Ç","—Å–æ–±–∞–∫–∞","–º—è—á","—Å—Ç–æ–ª","—Å—Ç—É–ª","–æ–∫–Ω–æ","–¥–≤–µ—Ä—å","–º–∞—à–∏–Ω–∞","—Ä—É—á–∫–∞","–∫–∞—Ä–∞–Ω–¥–∞—à","—Ç–µ—Ç—Ä–∞–¥—å","–ª–∞–º–ø–∞","–∫–Ω–∏–≥–∞","—Ç–µ–ª–µ—Ñ–æ–Ω","—á–∞—à–∫–∞","—Ç–∞—Ä–µ–ª–∫–∞","–ª–æ–∂–∫–∞","–≤–∏–ª–∫–∞","–Ω–æ–∂","—è–±–ª–æ–∫–æ","–±–∞–Ω–∞–Ω","—Ö–ª–µ–±","—Å—ã—Ä","–º–æ–ª–æ–∫–æ","—á–∞–π","–∫–æ—Ñ–µ","—Å–æ–∫","–≤–æ–¥–∞","—Ä—ã–±–∞","—Å–æ–ª—å","—Å–∞—Ö–∞—Ä","–º–∞—Å–ª–æ","—è–π—Ü–æ","–±–æ—Ç–∏–Ω–∫–∏","—à–∞–ø–∫–∞","–∫—É—Ä—Ç–∫–∞","–∑–æ–Ω—Ç","–æ—á–∫–∏","—á–∞—Å—ã","—Ñ—É—Ç–±–æ–ª","–≤–µ–ª–æ—Å–∏–ø–µ–¥","—Ä—é–∫–∑–∞–∫","–∫–∞—Ä—Ç–∞","–∫–ª—é—á","–∑–∞–º–æ–∫","–º–æ—Å—Ç","—É–ª–∏—Ü–∞","–ø–∞—Ä–∫","–ø–∞–ª—å—Ç–æ","—Å–≤–∏—Ç–µ—Ä","–Ω–æ—Å–∫–∏","–ø–µ—Ä—á–∞—Ç–∫–∏","—à–∞—Ä—Ñ","–ø–æ–µ–∑–¥","–∞–≤—Ç–æ–±—É—Å","—Å–∞–º–æ–ª—ë—Ç","–∫–æ—Ä–∞–±–ª—å","–¥–µ—Ä–µ–≤–æ","—Ü–≤–µ—Ç–æ–∫","—Ç—Ä–∞–≤–∞","—Ä–µ–∫–∞","–º–æ—Ä–µ","–≥–æ—Ä–∞","–æ–±–ª–∞–∫–æ","—Å–æ–ª–Ω—Ü–µ","–ª—É–Ω–∞","–∑–≤–µ–∑–¥–∞","–¥–æ–∂–¥—å","—Å–Ω–µ–≥","–≤–µ—Ç–µ—Ä","–≥—Ä–æ–º","–º–æ–ª–Ω–∏—è","–ø–µ—Å–æ–∫","–ø–ª—è–∂","–ø–µ—á–µ–Ω—å–µ","—Ç–æ—Ä—Ç","–∫–æ–Ω—Ñ–µ—Ç–∞","—à–æ–∫–æ–ª–∞–¥","–º–æ—Ä–æ–∑","—Ç–µ–ø–ª–æ","—Ö–æ–ª–æ–¥","–ª–µ—Ç–æ","–æ—Å–µ–Ω—å","–∑–∏–º–∞","–≤–µ—Å–Ω–∞","—Å—É–º–∫–∞","–∫—Ä–µ—Å–ª–æ","–¥–∏–≤–∞–Ω","–∫—Ä–æ–≤–∞—Ç—å","–ø–æ–¥—É—à–∫–∞","–æ–¥–µ—è–ª–æ","–∫–æ–≤—ë—Ä","–ø–æ–ª–∫–∞","–¥–æ—Å–∫–∞","–¥–≤–µ—Ä—Ü–∞"],
    medium:["–º—É–∑—ã–∫–∞–Ω—Ç","—Ç–∞–Ω—Ü–æ—Ä","—Ö—É–¥–æ–∂–Ω–∏–∫","–∞–∫—Ç—ë—Ä","—Ä–µ–∂–∏—Å—Å—ë—Ä","–±–∏–±–ª–∏–æ—Ç–µ–∫–∞","–º—É–∑–µ–π","—Ç–µ–∞—Ç—Ä","–∫–∏–Ω–æ","–∫–æ–Ω—Ü–µ—Ä—Ç","–æ—Ä–∫–µ—Å—Ç—Ä","—Å–∫—Ä–∏–ø–∫–∞","—Ç—Ä—É–±–∞","–±–∞—Ä–∞–±–∞–Ω","–ø–∏–∞–Ω–∏–Ω–æ","–∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞","–∫–æ–º–ø—å—é—Ç–µ—Ä","–ø—Ä–∏–Ω—Ç–µ—Ä","–∏–Ω—Ç–µ—Ä–Ω–µ—Ç","–±—Ä–∞—É–∑–µ—Ä","–ø–µ—Ä–µ–≤–æ–¥—á–∏–∫","–∏–Ω–∂–µ–Ω–µ—Ä","–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä","—Å—Ç—Ä–æ–∏—Ç–µ–ª—å","–º–µ—Ö–∞–Ω–∏–∫","–ø–∏–ª–æ—Ç","–ø–æ—á—Ç–∞–ª—å–æ–Ω","–ø–æ–≤–∞—Ä","–ø–µ–∫–∞—Ä—å","–ø–∞—Ä–∞—à—é—Ç","–∫–æ–º–ø–∞—Å","–º–∏–∫—Ä–æ—Ñ–æ–Ω","—Ç–µ–ª–µ—Å–∫–æ–ø","–º–∏–∫—Ä–æ—Å–∫–æ–ø","–º–∞—Å–∫–∞—Ä–∞–¥","–ø–æ—Ä—Ç—Ä–µ—Ç","—Å–∫—É–ª—å–ø—Ç—É—Ä–∞","–∫–∞—Ä–∏–∫–∞—Ç—É—Ä–∞","–∏–ª–ª—é—Å—Ç—Ä–∞—Ü–∏—è","–º–∞—Ä—à—Ä—É—Ç","–∫–æ–º–µ—Ç–∞","–ø–ª–∞–Ω–µ—Ç–∞","–≥–∞–ª–∞–∫—Ç–∏–∫–∞","—Å–ø—É—Ç–Ω–∏–∫","–∫–æ—Å–º–æ–¥—Ä–æ–º","—Ä–∞–∫–µ—Ç–∞","–∞—Å—Ç—Ä–æ–Ω–∞–≤—Ç","–≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—è","–º–∞—Ä–∞—Ñ–æ–Ω","—ç—Å—Ç–∞—Ñ–µ—Ç–∞","—Ç—Ä–µ–∫","–ø–æ–ª–æ—Å–∞","—Å–∫–µ–π—Ç–±–æ—Ä–¥","—Å–∞–º–æ–∫–∞—Ç","—Ä–æ–ª–∏–∫–∏","–∫–∞–Ω–æ—ç","–ø–∞—Ä—É—Å","—è–∫–æ—Ä—å","–Ω–∞–≤–∏–≥–∞—Ç–æ—Ä","–ø–µ—Ä–µ–∫—Ä—ë—Å—Ç–æ–∫","–ø–µ—à–µ—Ö–æ–¥","—Å–≤–µ—Ç–æ—Ñ–æ—Ä","–ø–µ—Ä–µ—Ö–æ–¥","—ç—Å–∫–∞–ª–∞—Ç–æ—Ä","—Ç—É—Ä–Ω–∏–∫–µ—Ç","–¥–∏–∞–ª–µ–∫—Ç","—Å—Ü–µ–Ω–∞—Ä–∏–π","–º–µ—Ç–∞—Ñ–æ—Ä–∞","–∏—Ä–æ–Ω–∏—è","–∞–ª–ª–µ–≥–æ—Ä–∏—è","–ø–∞—Ä–∞–¥–æ–∫—Å","—Ñ–æ—Ä–º—É–ª–∞","—Ç–µ–æ—Ä–µ–º–∞","–ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è","—É—Ä–∞–≤–Ω–µ–Ω–∏–µ","—Ñ–æ—Ç–æ—Å–∏–Ω—Ç–µ–∑","–¥–∏–∞–≥—Ä–∞–º–º–∞","–≥—Ä–∞—Ñ–∏–∫","–∞–ª–≥–æ—Ä–∏—Ç–º","–∞—Ä—Ö–∏–≤","–ø—Ä–æ—Ç–æ–∫–æ–ª","—Å–µ—Ä–≤–µ—Ä","–∫–ª–∏–µ–Ω—Ç","–ø–∞—Ä–æ–ª—å","—à–∏—Ñ—Ä","–≤–æ–ª–æ–Ω—Ç—ë—Ä","—è—Ä–º–∞—Ä–∫–∞","–ø—Ä–∞–∑–¥–Ω–∏–∫","—Ñ–µ—Å—Ç–∏–≤–∞–ª—å","–∫–∞–ø–∏—Ç–∞–Ω","–∫–æ–º–∞–Ω–¥–∞","—Å—Ç—Ä–∞—Ç–µ–≥–∏—è","—Ç–∞–∫—Ç–∏–∫–∞","–∫–∞–ø–ª—è","—É–∑–æ—Ä"],
    hard:["–∞–º–±–∏–≤–∞–ª–µ–Ω—Ç–Ω–æ—Å—Ç—å","–∫–æ–Ω—Ñ–æ—Ä–º–∏–∑–º","–ø–∞—Ä–∞–¥–∏–≥–º–∞","–∫–∞—Ç–∞—Ä—Å–∏—Å","—ç–Ω—Ç—Ä–æ–ø–∏—è","–∞–ø–æ—Ñ–µ–Ω–∏—è","–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è","–¥–∏—Å—Å–æ—Ü–∏–∞—Ü–∏—è","–∫–æ–Ω—Å–µ–Ω—Å—É—Å","—Ä–µ–¥—É–∫—Ü–∏–æ–Ω–∏–∑–º","—Ä–µ—Ñ–ª–µ–∫—Å–∏—è","–æ–Ω—Ç–æ–ª–æ–≥–∏—è","—ç–≤—Ä–∏—Å—Ç–∏–∫–∞","–≥–µ—Ä–º–µ–Ω–µ–≤—Ç–∏–∫–∞","–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å","–∏–º–ø–ª–∏–∫–∞—Ü–∏—è","–¥–µ–¥—É–∫—Ü–∏—è","–∏–Ω–¥—É–∫—Ü–∏—è","—Å—É–ø—Ä–µ–º–∞—Ç–∏–∑–º","—Å–∏–Ω–µ—Ä–≥–∏—è","–ø–∞–ª–∏–Ω–¥—Ä–æ–º","–æ–∫—Å—é–º–æ—Ä–æ–Ω","–º–µ—Ç–∞–º–æ—Ä—Ñ–æ–∑–∞","–∫–∞—Ç–µ–≥–æ—Ä–∏—á–Ω–æ—Å—Ç—å","–¥–∏–∞—Ö—Ä–æ–Ω–∏—è","—Å–∏–Ω–µ–∫–¥–æ—Ö–∞","–∞–ª–ª–∏—Ç–µ—Ä–∞—Ü–∏—è","–ø–µ—Ä—Ñ–µ–∫—Ü–∏–æ–Ω–∏–∑–º","–ø—Ä–µ—Ñ–µ—Ä–µ–Ω—Ü–∏—è","–∫–æ–≥–µ–∑–∏—è","–∫–æ–≥–µ—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å","—Å—É–±—Å—Ç–∞–Ω—Ü–∏—è","—Ç—Ä–∞–Ω—Å—Ü–µ–Ω–¥–µ–Ω—Ç–Ω–æ—Å—Ç—å","–∏–º–º–∞–Ω–µ–Ω—Ç–Ω–æ—Å—Ç—å","—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è","—Ä–µ–ª—è—Ç–∏–≤–∏–∑–º","—ç–∫—Å—Ç—Ä–∞–ø–æ–ª—è—Ü–∏—è","–∏–Ω—Ç–µ—Ä–ø–æ–ª—è—Ü–∏—è","–∫–æ–º–±–∏–Ω–∞—Ç–æ—Ä–∏–∫–∞","–∞–∫—Å–∏–æ–º–∞","–ª–µ–º–º–∞","–∫–æ—Ä—Ä–µ–ª—è—Ü–∏—è","–¥–µ–∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è","—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è","–∫–≤–∞–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è","–∏–Ω—Ç–µ—Ä—Ñ–µ—Ä–µ–Ω—Ü–∏—è","—Ñ–ª—É–∫—Ç—É–∞—Ü–∏—è","—Å—É–ø–µ—Ä–ø–æ–∑–∏—Ü–∏—è","–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å","–∞—Å–∏–º–ø—Ç–æ—Ç–∞","–¥–∏—Ñ—Ñ–µ—Ä–µ–Ω—Ü–∏–∞—Ü–∏—è","–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è","–¥–∏—Å–ø–µ—Ä—Å–∏—è","–∫–æ–Ω—Ñ–∞–±—É–ª—è—Ü–∏—è","—ç–∫—Å–ø–ª–∏–∫–∞—Ü–∏—è","–∏–º–ø–µ–¥–∞–Ω—Å","—Ä–µ–∑–∏—Å—Ç–∏–≤–Ω–æ—Å—Ç—å","–∏–Ω–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å","–∞–±–µ—Ä—Ä–∞—Ü–∏—è","–∞–¥–∏–∞–±–∞—Ç–∏—á–µ—Å–∫–∏–π","—ç–Ω—Ç–∞–ª—å–ø–∏—è","–∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç","–∞–ø–ø—Ä–æ–∫—Å–∏–º–∞—Ü–∏—è","–∞–≥—Ä–µ–≥–∞—Ü–∏—è","–∞–Ω–∞–ª–æ–≥–∏—è","–∞–Ω—Ç–∏–Ω–æ–º–∏—è","–∞–ø–æ—Ñ–µ–æ–∑","–∫–æ–Ω–≥—Ä—É—ç–Ω—Ç–Ω–æ—Å—Ç—å","–∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è","–∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä","–∫—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è","—Å—Ç–æ—Ö–∞—Å—Ç–∏–∫–∞","–≥–æ–º–æ–º–æ—Ä—Ñ–∏–∑–º","–∏–∑–æ–º–æ—Ä—Ñ–∏–∑–º","–±–∏–µ–∫—Ü–∏—è","–¥–∏—Ñ—Ñ—É–∑–∏—è","–∫–æ–Ω–¥–µ–Ω—Å–∞—Ü–∏—è","—Å—É–±–ª–∏–º–∞—Ü–∏—è","–∞–¥—Å–æ—Ä–±—Ü–∏—è","–¥–µ—Å–æ—Ä–±—Ü–∏—è","—Ç–µ—Ä–º–æ–¥–∏–Ω–∞–º–∏–∫–∞","–∫–∞—Ç–∞–ª–∏–∑","–∏–Ω–≥–∏–±–∏—Ç–æ—Ä","—Ä–µ–∫—É—Ä—Å–∏—è","–∏—Ç–µ—Ä–∞—Ü–∏—è","—Ä–µ–≥—Ä–µ—Å—Å–∏—è","–º–∞—Ä–∫–æ–≤—Å–∫–∞—è —Ü–µ–ø—å","–≥—Ä–∞–¥–∏–µ–Ω—Ç","–¥–∏–≤–µ—Ä–≥–µ–Ω—Ü–∏—è","–ª–∞–ø–ª–∞—Å–∏–∞–Ω","–∫—É–º—É–ª—è—Ç–∏–≤–Ω—ã–π","–ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–π"],
    films_series:["–¢–∏—Ç–∞–Ω–∏–∫","–ê–≤–∞—Ç–∞—Ä","–ú–∞—Ç—Ä–∏—Ü–∞","–ò–Ω—Ç–µ—Ä—Å—Ç–µ–ª–ª–∞—Ä","–ù–∞—á–∞–ª–æ","–¢–µ–º–Ω—ã–π —Ä—ã—Ü–∞—Ä—å","–î–∂–æ–∫–µ—Ä","–í–ª–∞—Å—Ç–µ–ª–∏–Ω –∫–æ–ª–µ—Ü","–•–æ–±–±–∏—Ç","–ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä","–ó–≤—ë–∑–¥–Ω—ã–µ –≤–æ–π–Ω—ã","–ú–∞–Ω–¥–∞–ª–æ—Ä–µ—Ü","–ò–≥—Ä–∞ –ø—Ä–µ—Å—Ç–æ–ª–æ–≤","–î–æ–º –¥—Ä–∞–∫–æ–Ω–∞","–í–µ–¥—å–º–∞–∫","–®–µ—Ä–ª–æ–∫","–î–æ–∫—Ç–æ—Ä –•–∞—É—Å","–î—Ä—É–∑—å—è","–¢–µ–æ—Ä–∏—è –±–æ–ª—å—à–æ–≥–æ –≤–∑—Ä—ã–≤–∞","–û—Ñ–∏—Å","–ü–æ–±–µ–≥ –∏–∑ –®–æ—É—à–µ–Ω–∫–∞","–ó–µ–ª—ë–Ω–∞—è –º–∏–ª—è","–§–æ—Ä—Ä–µ—Å—Ç –ì–∞–º–ø","1+1","–õ–∞-–ª–∞-–ª–µ–Ω–¥","–ö—Ä–µ—Å—Ç–Ω—ã–π –æ—Ç–µ—Ü","–¢–∞–∫—Å–∏—Å—Ç","–û—Å—Ç—Ä–æ–≤ –ø—Ä–æ–∫–ª—è—Ç—ã—Ö","–ë–æ–π—Ü–æ–≤—Å–∫–∏–π –∫–ª—É–±","–°–µ–º—å","–ö—Ä–∏–º–∏–Ω–∞–ª—å–Ω–æ–µ —á—Ç–∏–≤–æ","–ö–∏–ª –ë–∏–ª–ª","–û–¥–Ω–∞–∂–¥—ã –≤ –ì–æ–ª–ª–∏–≤—É–¥–µ","–î—é–Ω–∞","–ë–µ–≥—É—â–∏–π –ø–æ –ª–µ–∑–≤–∏—é","–ß—É–∂–æ–π","–•–∏—â–Ω–∏–∫","–¢–µ—Ä–º–∏–Ω–∞—Ç–æ—Ä","–†–æ–±–æ–∫–æ–ø","–ß–µ–ª–æ–≤–µ–∫-–ø–∞—É–∫","–ñ–µ–ª–µ–∑–Ω—ã–π —á–µ–ª–æ–≤–µ–∫","–ú—Å—Ç–∏—Ç–µ–ª–∏","–ö–∞–ø–∏—Ç–∞–Ω –ê–º–µ—Ä–∏–∫–∞","–¢–æ—Ä","–ß–µ—Ä–Ω–∞—è –ø–∞–Ω—Ç–µ—Ä–∞","–°—Ç—Ä–∞–∂–∏ –ì–∞–ª–∞–∫—Ç–∏–∫–∏","–î—ç–¥–ø—É–ª","–õ–æ–∫–∏","–í–æ –≤—Å–µ —Ç—è–∂–∫–∏–µ","–õ—É—á—à–µ –∑–≤–æ–Ω–∏—Ç–µ –°–æ–ª—É","–ù–∞—Ä–∫–æ—Å","–ü–∏–∫–∫–∏ –ë–ª–∞–π–Ω–¥–µ—Ä—Å","–í–∏–∫–∏–Ω–≥–∏","–ß—ë—Ä–Ω–æ–µ –∑–µ—Ä–∫–∞–ª–æ","–û—á–µ–Ω—å —Å—Ç—Ä–∞–Ω–Ω—ã–µ –¥–µ–ª–∞","–ö–æ—Ä–æ–ª—å –õ–µ–≤","–ê–ª–ª–∞–¥–∏–Ω","–•–æ–ª–æ–¥–Ω–æ–µ —Å–µ—Ä–¥—Ü–µ","–¢–∞–π–Ω–∞ –ö–æ–∫–æ","–ò—Å—Ç–æ—Ä–∏—è –∏–≥—Ä—É—à–µ–∫","–†–∞—Ç–∞—Ç—É–π","–í–ê–õ–õ¬∑–ò","–í–≤–µ—Ä—Ö","–ì–æ–ª–æ–≤–æ–ª–æ–º–∫–∞","–ú–æ–∞–Ω–∞","–ü–∏—Ä–∞—Ç—ã –ö–∞—Ä–∏–±—Å–∫–æ–≥–æ –º–æ—Ä—è","–ò–Ω–¥–∏–∞–Ω–∞ –î–∂–æ–Ω—Å","–ú–∏—Å—Å–∏—è –Ω–µ–≤—ã–ø–æ–ª–Ω–∏–º–∞","–î–∂–µ–π–º—Å –ë–æ–Ω–¥","–®—Ä–µ–∫","–ú–∞–¥–∞–≥–∞—Å–∫–∞—Ä","–ö—É–Ω–≥-—Ñ—É –ü–∞–Ω–¥–∞","–ö–∞–∫ –ø—Ä–∏—Ä—É—á–∏—Ç—å –¥—Ä–∞–∫–æ–Ω–∞","–ì–ª–∞–¥–∏–∞—Ç–æ—Ä","–¢—Ä–æ—è","300 —Å–ø–∞—Ä—Ç–∞–Ω—Ü–µ–≤","–•—Ä–∞–±—Ä–æ–µ —Å–µ—Ä–¥—Ü–µ","–ú–∞—Ä—Å–∏–∞–Ω–∏–Ω","–í—ã–∂–∏–≤—à–∏–π","–ë–æ–ª—å—à–æ–π –∫—É—à","–ö–∞—Ä—Ç—ã, –¥–µ–Ω—å–≥–∏, –¥–≤–∞ —Å—Ç–≤–æ–ª–∞","–î–æ—Å—Ç–∞—Ç—å –Ω–æ–∂–∏","–ö–∏–Ω–≥—Å–º–∞–Ω","–î–∂–µ–Ω—Ç–ª—å–º–µ–Ω—ã","–ê—Ä–∫–µ–π–Ω","–ö–æ–±—Ä–∞ –ö–∞–π","–°–æ—Ç–Ω—è","–ö–æ–ª–µ—Å–æ –≤—Ä–µ–º–µ–Ω–∏","–§–∞—É–¥–∞","–û—Ñ–∏—Å (UK)"],
    geography:["–ï–≤—Ä–æ–ø–∞","–ê–∑–∏—è","–ê—Ñ—Ä–∏–∫–∞","–°–µ–≤–µ—Ä–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞","–Æ–∂–Ω–∞—è –ê–º–µ—Ä–∏–∫–∞","–ê–≤—Å—Ç—Ä–∞–ª–∏—è","–ê–Ω—Ç–∞—Ä–∫—Ç–∏–¥–∞","–†–æ—Å—Å–∏—è","–ú–æ—Å–∫–≤–∞","–°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥","–°–®–ê","–í–∞—à–∏–Ω–≥—Ç–æ–Ω","–ù—å—é-–ô–æ—Ä–∫","–õ–æ—Å-–ê–Ω–¥–∂–µ–ª–µ—Å","–ö–∞–Ω–∞–¥–∞","–û—Ç—Ç–∞–≤–∞","–¢–æ—Ä–æ–Ω—Ç–æ","–ú–µ–∫—Å–∏–∫–∞","–ë—Ä–∞–∑–∏–ª–∏—è","–†–∏–æ-–¥–µ-–ñ–∞–Ω–µ–π—Ä–æ","–ê—Ä–≥–µ–Ω—Ç–∏–Ω–∞","–ë—É—ç–Ω–æ—Å-–ê–π—Ä–µ—Å","–ß–∏–ª–∏","–ü–µ—Ä—É","–õ–∏–º–∞","–ö–æ–ª—É–º–±–∏—è","–ë–æ–≥–æ—Ç–∞","–ì–µ—Ä–º–∞–Ω–∏—è","–ë–µ—Ä–ª–∏–Ω","–§—Ä–∞–Ω—Ü–∏—è","–ü–∞—Ä–∏–∂","–ò—Å–ø–∞–Ω–∏—è","–ú–∞–¥—Ä–∏–¥","–ò—Ç–∞–ª–∏—è","–†–∏–º","–ú–∏–ª–∞–Ω","–í–µ–Ω–µ—Ü–∏—è","–ü–∏–∑–∞","–ì—Ä–µ—Ü–∏—è","–ê—Ñ–∏–Ω—ã","–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è","–õ–æ–Ω–¥–æ–Ω","–ù–æ—Ä–≤–µ–≥–∏—è","–®–≤–µ—Ü–∏—è","–°—Ç–æ–∫–≥–æ–ª—å–º","–§–∏–Ω–ª—è–Ω–¥–∏—è","–•–µ–ª—å—Å–∏–Ω–∫–∏","–î–∞–Ω–∏—è","–ö–æ–ø–µ–Ω–≥–∞–≥–µ–Ω","–ò—Å–ª–∞–Ω–¥–∏—è","–†–µ–π–∫—å—è–≤–∏–∫","–ü–æ–ª—å—à–∞","–í–∞—Ä—à–∞–≤–∞","–ß–µ—Ö–∏—è","–ü—Ä–∞–≥–∞","–ê–≤—Å—Ç—Ä–∏—è","–í–µ–Ω–∞","–®–≤–µ–π—Ü–∞—Ä–∏—è","–¶—é—Ä–∏—Ö","–ù–∏–¥–µ—Ä–ª–∞–Ω–¥—ã","–ê–º—Å—Ç–µ—Ä–¥–∞–º","–ë–µ–ª—å–≥–∏—è","–ë—Ä—é—Å—Å–µ–ª—å","–ü–æ—Ä—Ç—É–≥–∞–ª–∏—è","–õ–∏—Å—Å–∞–±–æ–Ω","–¢—É—Ä—Ü–∏—è","–°—Ç–∞–º–±—É–ª","–ê–Ω–∫–∞—Ä–∞","–ï–≥–∏–ø–µ—Ç","–ö–∞–∏—Ä","–ú–∞—Ä–æ–∫–∫–æ","–†–∞–±–∞—Ç","–Æ–∂–Ω–∞—è –ê—Ñ—Ä–∏–∫–∞","–ö–µ–π–ø—Ç–∞—É–Ω","–ù–∏–≥–µ—Ä–∏—è","–ê–±—É–¥–∂–∞","–ö–µ–Ω–∏—è","–ù–∞–π—Ä–æ–±–∏","–≠—Ñ–∏–æ–ø–∏—è","–ê–¥–¥–∏—Å-–ê–±–µ–±–∞","–ò–∑—Ä–∞–∏–ª—å","–ò–µ—Ä—É—Å–∞–ª–∏–º","–ò–æ—Ä–¥–∞–Ω–∏—è","–ê–º–º–∞–Ω","–°–∞—É–¥–æ–≤—Å–∫–∞—è –ê—Ä–∞–≤–∏—è","–≠—Ä-–†–∏—è–¥","–û–ê–≠","–î—É–±–∞–π","–ò–Ω–¥–∏—è","–î–µ–ª–∏","–ú—É–º–±–∞–∏","–ù–µ–ø–∞–ª","–ö–∞—Ç–º–∞–Ω–¥—É","–ö–∏—Ç–∞–π","–ü–µ–∫–∏–Ω","–í–µ–ª–∏–∫–∞—è –∫–∏—Ç–∞–π—Å–∫–∞—è —Å—Ç–µ–Ω–∞"],
    kids:["–º—è—á","–∫—É–∫–ª–∞","–º–∏—à–∫–∞","–∑–∞–π—á–∏–∫","—Å–æ–ª–Ω—ã—à–∫–æ","–æ–±–ª–∞–∫–æ","—Ä–∞–¥—É–≥–∞","—Å–Ω–µ–∂–∏–Ω–∫–∞","—Å–∞–Ω–∫–∏","–≤–∞—Ä–µ–∂–∫–∏","—à–∞–ø–∫–∞","—à–∞—Ä—Ñ","–º–∞—à–∏–Ω–∫–∞","–ø–∞—Ä–æ–≤–æ–∑","–ø–æ–µ–∑–¥","—Å–∞–º–æ–ª—ë—Ç","—Ä–∞–∫–µ—Ç–∞","–ª–æ–¥–∫–∞","–ø–∞—Ä—É—Å","–≤–µ–ª–æ—Å–∏–ø–µ–¥","—Å–∞–º–æ–∫–∞—Ç","–∫–∞—á–µ–ª–∏","–≥–æ—Ä–∫–∞","–∫–∞—Ä—É—Å–µ–ª—å","–∑–æ–æ–ø–∞—Ä–∫","—Ü–∏—Ä–∫","–ø–∞—Ä–∫","–∏–≥—Ä—É—à–∫–∞","–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä","–∫—É–±–∏–∫–∏","–ø–∞–∑–ª","—Ä–∞—Å–∫—Ä–∞—Å–∫–∞","—Ñ–ª–æ–º–∞—Å—Ç–µ—Ä","–∫–∞—Ä–∞–Ω–¥–∞—à","–∫–∏—Å—Ç–æ—á–∫–∞","–∫—Ä–∞—Å–∫–∏","–ø–ª–∞—Å—Ç–∏–ª–∏–Ω","–Ω–æ–∂–Ω–∏—Ü—ã","–∫–ª–µ–π","–∫–Ω–∏–∂–∫–∞","—Å–∫–∞–∑–∫–∞","–ø–µ—Å–Ω—è","—Ç–∞–Ω–µ—Ü","–º—É–∑—ã–∫–∞","–ø—Ä–∞–∑–¥–Ω–∏–∫","–ø–æ–¥–∞—Ä–æ–∫","—à–∞—Ä–∏–∫","—Ç–æ—Ä—Ç","—Å–≤–µ—á–∏","–ø–µ—á–µ–Ω—å–µ","–∫–æ–Ω—Ñ–µ—Ç–∞","—à–æ–∫–æ–ª–∞–¥","–º–æ—Ä–æ–∂–µ–Ω–æ–µ","—è–±–ª–æ–∫–æ","–±–∞–Ω–∞–Ω","–≥—Ä—É—à–∞","–∞–ø–µ–ª—å—Å–∏–Ω","–∫–ª—É–±–Ω–∏–∫–∞","–≤–∏—à–Ω—è","–∞—Ä–±—É–∑","–¥—ã–Ω—è","–º–æ—Ä–∫–æ–≤—å","–æ–≥—É—Ä–µ—Ü","–ø–æ–º–∏–¥–æ—Ä","—Å—É–ø","–∫–∞—à–∞","–∫–æ—Ç—ë–Ω–æ–∫","—â–µ–Ω–æ–∫","—Ö–æ–º—è–∫","—Ä—ã–±–∫–∞","—á–µ—Ä–µ–ø–∞—Ö–∞","–ª—è–≥—É—à–∫–∞","—É—Ç—ë–Ω–æ–∫","—Å–ª–æ–Ω","–∂–∏—Ä–∞—Ñ","–ª–µ–≤","—Ç–∏–≥—Ä","–∑–µ–±—Ä–∞","–ø–∞–Ω–¥–∞","–¥–æ–º–∏–∫","–∫—Ä–æ–≤–∞—Ç–∫–∞","–ø–æ–¥—É—à–∫–∞","–æ–¥–µ—è–ª–æ","–≤–∞–Ω–Ω–∞","–º—ã–ª–æ","—â—ë—Ç–∫–∞","–ø–∞—Å—Ç–∞","–ø–æ–ª–æ—Ç–µ–Ω—Ü–µ","–∫–æ–ª—è—Å–∫–∞","–º–∞–º–∞","–ø–∞–ø–∞","–±–∞–±—É—à–∫–∞","–¥–µ–¥—É—à–∫–∞","–±—Ä–∞—Ç","—Å–µ—Å—Ç—Ä–∞","–¥—Ä—É–≥","–ø–æ–¥—Ä—É–≥–∞","–ø—Ä—è—Ç–∫–∏","—Å–∞–ª–æ—á–∫–∏"]
  };

  const TEAM_ICONS = [
    {id:'sun', emoji:'üåû', bg:'linear-gradient(135deg,#fde047,#f97316)', color:'#1f2937'},
    {id:'rocket', emoji:'üöÄ', bg:'linear-gradient(135deg,#60a5fa,#2563eb)', color:'#0f172a'},
    {id:'leaf', emoji:'üçÄ', bg:'linear-gradient(135deg,#86efac,#22c55e)', color:'#052e16'},
    {id:'wave', emoji:'üê¨', bg:'linear-gradient(135deg,#67e8f9,#0ea5e9)', color:'#0f172a'},
    {id:'crown', emoji:'üëë', bg:'linear-gradient(135deg,#fcd34d,#a855f7)', color:'#312e81'},
    {id:'gamepad', emoji:'üéÆ', bg:'linear-gradient(135deg,#f472b6,#a855f7)', color:'#1e1b4b'},
    {id:'bolt', emoji:'‚ö°', bg:'linear-gradient(135deg,#f97316,#ef4444)', color:'#111827'},
    {id:'snow', emoji:'‚ùÑÔ∏è', bg:'linear-gradient(135deg,#bfdbfe,#60a5fa)', color:'#1e3a8a'}
  ];
  const defaultTeamName = idx => `–ö–æ–º–∞–Ω–¥–∞ ${idx+1}`;
  const makeTeam = (name, icon) => ({name, icon, points:0, hit:0, miss:0, hitWords:[], missWords:[]});
  const getTeamIcon = id => TEAM_ICONS.find(icon=>icon.id===id) || TEAM_ICONS[0];
  let audioCtx = null;
  function playBuzz(){
    try{
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      if (!AudioCtx) return;
      if (!audioCtx) audioCtx = new AudioCtx();
      if (audioCtx.state === 'suspended') audioCtx.resume();
      const duration = 0.35;
      const sampleRate = audioCtx.sampleRate;
      const buffer = audioCtx.createBuffer(1, sampleRate * duration, sampleRate);
      const data = buffer.getChannelData(0);
      for (let i=0;i<data.length;i++){
        const progress = i / data.length;
        data[i] = (Math.random()*2 - 1) * (1 - progress) * 0.7;
      }
      const noise = audioCtx.createBufferSource();
      noise.buffer = buffer;
      const gain = audioCtx.createGain();
      gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
      noise.connect(gain).connect(audioCtx.destination);
      noise.start();
    }catch(err){ /* ignore playback errors */ }
  }

  // Navigation
  const show = v => {
    ['viewMenu','viewQuickGame','viewTeamSetup','viewTeamGame'].forEach(id=>{
      const el = $('#'+id);
      if (el) el.style.display='none';
    });
    $('#'+v).style.display='flex';
    screen = v;
    if (themeSection) themeSection.style.display = v==='viewMenu' ? 'flex' : 'none';
    if (v==='viewMenu'){
      backBtn.style.visibility = 'hidden';
      backBtn.style.pointerEvents = 'none';
      if (modeQuickBtn) modeQuickBtn.classList.add('active');
    }else{
      backBtn.style.visibility = 'visible';
      backBtn.style.pointerEvents = 'auto';
      if (modeQuickBtn) modeQuickBtn.classList.remove('active');
    }
  };

  // Header buttons
  backBtn.onclick = () => {
    if (screen==='viewQuickGame' || screen==='viewTeamGame'){
      if (!confirm('–í—ã–π—Ç–∏ –≤ –º–µ–Ω—é? –¢–µ–∫—É—â–∞—è –ø–∞—Ä—Ç–∏—è –±—É–¥–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∞.')) return;
    }
    if (typeof qTimerId !== 'undefined'){ clearInterval(qTimerId); qTimerId=null; }
    if (typeof tTimerId !== 'undefined'){ clearInterval(tTimerId); tTimerId=null; }
    show('viewMenu');
  };
  helpBtn.onclick = () => {
    alert('–ö—Ä–æ–∫–æ–ú–∏–º ‚Äî –æ–±—ä—è—Å–Ω–∏—Ç–µ —Å–ª–æ–≤–æ –∂–µ—Å—Ç–∞–º–∏/–º–∏–º–∏–∫–æ–π. –ö–Ω–æ–ø–∫–∏: –£–≥–∞–¥–∞–Ω–æ, –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å, –°–ª–µ–¥—É—é—â–µ–µ; –º–æ–∂–Ω–æ —Å–∫—Ä—ã—Ç—å/–ø–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≤–æ –∏ –æ—Ç–∫—Ä—ã—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –í–∏–∫–∏–ø–µ–¥–∏–∏. –£–¥–∞—á–∏!');
  };

  $('#goTeam').onclick = () => {
    ensureTeamsSeed();
    renderTeams();
    syncTeamSettingsFromMenu();
    show('viewTeamSetup');
  };

  // Quick setup
  const qs = {
    dict: $('#quickDict'),
    customBox: $('#quickCustomBox'),
    customText: $('#quickCustomWords'),
    timerToggle: $('#quickTimerToggle'),
    time: 60,
    timeMinus: $('#quickTimeMinus'),
    timePlus: $('#quickTimePlus'),
    timeLabel: $('#quickTimeLabel'),
    ptsToggle: $('#quickPtsToggle'),
    ptsControls: $('#quickPtsControls'),
    pts: 10,
    ptsMinus: $('#quickPtsMinus'),
    ptsPlus: $('#quickPtsPlus'),
    ptsLabel: $('#quickPtsLabel'),
    start: $('#startQuick')
  };
  const upQuickTime = () => qs.timeLabel.textContent = qs.time+' —Å';
  const upQuickPts = () => qs.ptsLabel.textContent = qs.pts;
  upQuickTime();
  upQuickPts();
  qs.timerToggle.checked = false;
  qs.ptsToggle.checked = false;
  qs.timeMinus.onclick = () => { qs.time = Math.max(30, qs.time-30); upQuickTime(); };
  qs.timePlus.onclick = () => { qs.time += 30; upQuickTime(); };
  qs.dict.onchange = () => qs.customBox.style.display = (qs.dict.value==='custom')?'block':'none';
  qs.ptsMinus.onclick = () => { qs.pts = Math.max(1, qs.pts-1); upQuickPts(); };
  qs.ptsPlus.onclick = () => { qs.pts += 1; upQuickPts(); };
  const updateQuickPts = () => {
    if (!qs.ptsControls) return;
    const enabled = qs.ptsToggle.checked;
    qs.ptsControls.style.display = enabled ? 'flex' : 'none';
  };
  qs.ptsToggle.onchange = updateQuickPts;
  updateQuickPts();
  if (qs.dict){
    qs.dict.value = 'medium';
    qs.dict.dispatchEvent(new Event('change'));
  }

  // Quick game state
  let qWords=[], qIndex=0, qHide=false, qRemain=0, qHit=0, qMiss=0, qTarget=null, qHitWords=[], qMissWords=[];

  const qUI = {
    word: $('#qWord'),
    hit: $('#qHit'), miss: $('#qMiss'),
    next: $('#qNext'), hitBtn: $('#qHitBtn'), skipBtn: $('#qSkipBtn'),
    hideBtn: $('#qHideBtn'), meaningBtn: $('#qMeaningBtn'),
    tBox: $('#qTimerBox'), tLabel: $('#qTimer'),
    statsBtn: $('#qStatsBtn')
  };

  const pad = n => String(n).padStart(2,'0');
  const formatWordList = list => list.length ? list.join(', ') : '‚Äî';

  function showWordStats(title, hitList, missList){
    alert(`${title}\n\n–£–≥–∞–¥–∞–Ω–Ω—ã–µ (${hitList.length}):\n${formatWordList(hitList)}\n\n–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ (${missList.length}):\n${formatWordList(missList)}`);
  }

  function startQuickGame(){
    // build words
    let dictKey = qs.dict.value;
    if (!dictKey || (!DICTS[dictKey] && dictKey!=='custom')){
      dictKey = 'medium';
      if (qs.dict){
        qs.dict.value = 'medium';
        qs.dict.dispatchEvent(new Event('change'));
      }
    }
    if (dictKey==='custom'){
      const raw = qs.customText.value || '';
      qWords = raw.split(/[,\\n]/).map(s=>s.trim()).filter(Boolean);
    }else{
      qWords = [...DICTS[dictKey]];
    }
    if (qWords.length===0){ alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–ª–æ–≤–æ'); return; }
    shuffle(qWords);
    qIndex=0; qHide=false; qHit=0; qMiss=0; qTarget = qs.ptsToggle.checked ? qs.pts : null;
    qUI.hit.textContent = '0'; qUI.miss.textContent = '0';
    qHitWords = [];
    qMissWords = [];
    qUI.word.textContent = qWords[qIndex];
    qUI.hideBtn.textContent = '–°–∫—Ä—ã—Ç—å —Å–ª–æ–≤–æ';

    // timer
    clearInterval(qTimerId); qTimerId=null;
    if (qs.timerToggle.checked){
      qUI.tBox.style.display='inline-flex';
      qRemain = qs.time;
      qUI.tLabel.textContent = `${pad(Math.floor(qRemain/60))}:${pad(qRemain%60)}`;
      qTimerId = setInterval(()=>{
        qRemain--;
        qUI.tLabel.textContent = `${pad(Math.floor(qRemain/60))}:${pad(qRemain%60)}`;
        if (qRemain<=0){
          clearInterval(qTimerId); qTimerId=null;
          playBuzz();
          nextWord();
        }
      },1000);
    }else{
      qUI.tBox.style.display='none';
    }
    show('viewQuickGame');
  }
  $('#startQuick').onclick = startQuickGame;
  if (modeQuickBtn) modeQuickBtn.onclick = startQuickGame;

  function nextWord(){
    qIndex = (qIndex+1) % qWords.length;
    qHide=false;
    qUI.word.textContent = qWords[qIndex];
    qUI.hideBtn.textContent = '–°–∫—Ä—ã—Ç—å —Å–ª–æ–≤–æ';
  }

  qUI.next.onclick = nextWord;
  qUI.hitBtn.onclick = ()=>{
    qHit++;
    qUI.hit.textContent=qHit;
    const current = qWords[qIndex];
    if (current) qHitWords.push(current);
    if (qTarget!==null && qHit>=qTarget){
      if (qTimerId){ clearInterval(qTimerId); qTimerId=null; }
      playBuzz();
      alert('–í—ã –¥–æ—Å—Ç–∏–≥–ª–∏ —Ü–µ–ª–∏!');
      show('viewMenu');
      return;
    }
    nextWord();
  };
  qUI.skipBtn.onclick = ()=>{
    const current = qWords[qIndex];
    if (current) qMissWords.push(current);
    qMiss++;
    qUI.miss.textContent=qMiss;
    nextWord();
  };
  qUI.hideBtn.onclick = ()=>{
    qHide = !qHide;
    qUI.word.textContent = qHide ? '‚Ä¢‚Ä¢‚Ä¢' : qWords[qIndex];
    qUI.hideBtn.textContent = qHide ? '–ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≤–æ' : '–°–∫—Ä—ã—Ç—å —Å–ª–æ–≤–æ';
  };
  qUI.meaningBtn.onclick = ()=> window.open('https://ru.wikipedia.org/wiki/'+encodeURIComponent(qWords[qIndex]), '_blank');
  if (qUI.statsBtn){
    qUI.statsBtn.onclick = ()=>{
      showWordStats('–ë—ã—Å—Ç—Ä—ã–π —Ä–µ–∂–∏–º', qHitWords, qMissWords);
    };
  }

  // Team setup & game
  let teams = [];
  function ensureTeamsSeed(){
    if (teams.length===0){
      teams = [
        makeTeam(defaultTeamName(0), TEAM_ICONS[0].id),
        makeTeam(defaultTeamName(1), TEAM_ICONS[1].id)
      ];
    } else {
      teams = teams.map((team, idx)=>({
        ...team,
        name: team.name || defaultTeamName(idx),
        icon: team.icon || TEAM_ICONS[idx % TEAM_ICONS.length].id,
        points: team.points ?? 0,
        hit: team.hit ?? 0,
        miss: team.miss ?? 0,
        hitWords: Array.isArray(team.hitWords) ? team.hitWords : [],
        missWords: Array.isArray(team.missWords) ? team.missWords : []
      }));
    }
  }
  const teamList = $('#teamList');
  const teamRenameBtn = $('#teamRename');
  function renderTeams(){
    teamList.innerHTML='';
    teams.forEach((team, index)=>{
      if (!team.name) team.name = defaultTeamName(index);
      if (!team.icon) team.icon = TEAM_ICONS[index % TEAM_ICONS.length].id;
      const iconDef = getTeamIcon(team.icon);
      const card=document.createElement('div');
      card.className='section team-card';
      card.innerHTML = `
        <div class="team-card-top">
          <div class="team-avatar" style="background:${iconDef.bg};color:${iconDef.color}">
            <span>${iconDef.emoji}</span>
          </div>
        </div>
        <div class="team-body">
          <div class="team-name">${escapeHtml(team.name)}</div>
          <button class="team-delete" type="button" title="–£–¥–∞–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—É" data-index="${index}">üóëÔ∏è</button>
        </div>`;
      const deleteBtn = card.querySelector('.team-delete');
      if (deleteBtn){
        deleteBtn.setAttribute('aria-label', `–£–¥–∞–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—É ¬´${team.name || defaultTeamName(index)}¬ª`);
        deleteBtn.onclick = () => {
          if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∫–æ–º–∞–Ω–¥—É ¬´${team.name || defaultTeamName(index)}¬ª?`)) return;
          teams.splice(index, 1);
          renderTeams();
        };
      }
      teamList.appendChild(card);
    });
  }
  $('#teamAdd').onclick = ()=>{
    const icon = TEAM_ICONS[teams.length % TEAM_ICONS.length].id;
    teams.push(makeTeam(defaultTeamName(teams.length), icon));
    renderTeams();
  };
  if (teamRenameBtn){
    teamRenameBtn.onclick = ()=>{
      if (teams.length===0){ alert('–ù–µ—Ç –∫–æ–º–∞–Ω–¥ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è'); return; }
      const list = teams.map((team, idx)=>`${idx+1}. ${team.name || defaultTeamName(idx)}`).join('\n');
      const idxInput = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:\n'+list);
      if (idxInput===null) return;
      const idx = parseInt(idxInput, 10) - 1;
      if (Number.isNaN(idx) || idx<0 || idx>=teams.length){ alert('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –Ω–æ–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã'); return; }
      const current = teams[idx].name;
      const next = prompt('–ù–æ–≤–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã', current);
      if (next===null) return;
      const trimmed = next.trim();
      teams[idx].name = trimmed || defaultTeamName(idx);
      renderTeams();
    };
  }

  const ts = {
    dict: $('#teamDict'),
    customBox: $('#teamCustomBox'),
    customText: $('#teamCustomWords'),
    timerToggle: $('#teamTimerToggle'),
    time: 60,
    timeMinus: $('#teamTimeMinus'),
    timePlus: $('#teamTimePlus'),
    timeLabel: $('#teamTimeLabel'),
    ptsToggle: $('#teamPtsToggle'),
    ptsControls: $('#ptsControls'),
    pts: 10, ptsMinus: $('#ptsMinus'), ptsPlus: $('#ptsPlus'), ptsLabel: $('#ptsLabel')
  };
  const upTeamTime = () => ts.timeLabel.textContent = ts.time+' —Å';
  const upPts = () => ts.ptsLabel.textContent = ts.pts;
  upTeamTime(); upPts();
  ts.timeMinus.onclick = ()=>{ ts.time = Math.max(30, ts.time-30); upTeamTime(); };
  ts.timePlus.onclick = ()=>{ ts.time += 30; upTeamTime(); };
  ts.ptsMinus.onclick = ()=>{ ts.pts = Math.max(1, ts.pts-1); upPts(); };
  ts.ptsPlus.onclick = ()=>{ ts.pts += 1; upPts(); };
  ts.dict.onchange = ()=> ts.customBox.style.display = (ts.dict.value==='custom')?'block':'none';
  const updatePtsUI = ()=>{
    const enabled = ts.ptsToggle.checked;
    ts.ptsControls.style.display = enabled ? 'flex' : 'none';
  };
  ts.ptsToggle.onchange = updatePtsUI;
  updatePtsUI();

  function syncTeamSettingsFromMenu(){
    if (!qs || !ts) return;
    if (qs.dict && ts.dict){
      const dictValue = qs.dict.value || 'medium';
      ts.dict.value = dictValue;
      ts.dict.dispatchEvent(new Event('change'));
      if (dictValue === 'custom' && ts.customText && qs.customText){
        ts.customText.value = qs.customText.value;
      }
    }
    if (typeof qs.time === 'number'){
      ts.time = qs.time;
      upTeamTime();
    }
    if (ts.timerToggle && qs.timerToggle){
      ts.timerToggle.checked = qs.timerToggle.checked;
    }
    if (typeof qs.pts === 'number'){
      ts.pts = qs.pts;
      upPts();
    }
    if (ts.ptsToggle && qs.ptsToggle){
      ts.ptsToggle.checked = qs.ptsToggle.checked;
    }
    updatePtsUI();
  }

  // Team game state
  let tWords=[], tIndex=-1, tHide=false, tRemain=0, turn=0, roundActive=false, timerExpired=false;

  const tUI = {
    word: $('#tWord'),
    turnName: $('#turnTeamName'),
    tBox: $('#tTimerBox'), tLabel: $('#tTimer'),
    table: $('#scoreTable'),
    next: $('#tNext'), hit: $('#tHitBtn'), skip: $('#tSkipBtn'),
    hideBtn: $('#tHideBtn'), meaning: $('#tMeaningBtn'),
    startRound: $('#tStartRound'), endRound: $('#tEndRound'),
    status: $('#tRoundStatus'),
    statsBtn: $('#tStatsBtn')
  };

  function updateTurnHeader(){
    if (!teams[turn]) return;
    const current = teams[turn];
    const iconDef = getTeamIcon(current.icon);
    tUI.turnName.innerHTML = `<span class="team-chip-icon">${iconDef.emoji}</span>${escapeHtml(current.name || defaultTeamName(turn))}`;
  }

  function renderScore(){
    tUI.table.innerHTML='';
    teams.forEach((team, idx)=>{
      const iconDef = getTeamIcon(team.icon);
      const row=document.createElement('div');
      row.className='row';
      row.innerHTML = `
        <div class="chip team-chip" style="min-width:160px">
          <span class="team-chip-icon">${iconDef.emoji}</span>
          ${escapeHtml(team.name || defaultTeamName(idx))}
        </div>
        <div class="chip">–£–≥–∞–¥–∞–Ω–æ: ${team.hit}</div>
        <div class="chip">–ü—Ä–æ–ø—É—â–µ–Ω–æ: ${team.miss}</div>
        <div class="chip">–û—á–∫–∏: ${team.points}</div>`;
      tUI.table.appendChild(row);
    });
  }

  function setRoundControlsEnabled(enabled){
    [tUI.next, tUI.hit, tUI.skip, tUI.hideBtn, tUI.meaning].forEach(btn=>{
      if (btn){
        btn.disabled = !enabled;
      }
    });
  }

  function resetWordView(){
    tHide = false;
    if (tUI.word) tUI.word.textContent = '‚Äî';
    if (tUI.hideBtn) tUI.hideBtn.textContent = '–°–∫—Ä—ã—Ç—å —Å–ª–æ–≤–æ';
  }

  function advanceWord(){
    if (!tWords.length) return;
    tIndex = (tIndex + 1) % tWords.length;
    tHide = false;
    if (tUI.word) tUI.word.textContent = tWords[tIndex];
    if (tUI.hideBtn) tUI.hideBtn.textContent = '–°–∫—Ä—ã—Ç—å —Å–ª–æ–≤–æ';
  }

  function setStatus(text){
    if (tUI.status) tUI.status.textContent = text;
  }

  function preRoundMessage(name, initial){
    if (!name) return;
    if (initial){
      setStatus(`–ö–æ–º–∞–Ω–¥–∞ ¬´${name}¬ª, –ø—Ä–∏–≥–æ—Ç–æ–≤—å—Ç–µ—Å—å –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ù–∞—á–∞—Ç—å —Ä–∞—É–Ω–¥¬ª.`);
    }else{
      setStatus(`–•–æ–¥ –∑–∞–≤–µ—Ä—à—ë–Ω. –ü–µ—Ä–µ–¥–∞–π—Ç–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∫–æ–º–∞–Ω–¥–µ ¬´${name}¬ª –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ù–∞—á–∞—Ç—å —Ä–∞—É–Ω–¥¬ª.`);
    }
  }

  function startTeamGame(){
    if (teams.length<2){ alert('–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º 2 –∫–æ–º–∞–Ω–¥—ã'); return; }
    let dictKey = ts.dict.value;
    if (!dictKey || (!DICTS[dictKey] && dictKey !== 'custom')){
      dictKey = 'medium';
      if (ts.dict){
        ts.dict.value = 'medium';
        ts.dict.dispatchEvent(new Event('change'));
      }
    }
    if (dictKey==='custom'){
      const raw = ts.customText.value || '';
      tWords = raw.split(/[,\n]/).map(s=>s.trim()).filter(Boolean);
    }else{
      tWords = [...DICTS[dictKey]];
    }
    if (tWords.length===0){ alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω–æ —Å–ª–æ–≤–æ'); return; }
    shuffle(tWords);
    teams = teams.map((t, idx)=>(
      {
        name: t.name || defaultTeamName(idx),
        icon: t.icon || TEAM_ICONS[idx % TEAM_ICONS.length].id,
        points:0,
        hit:0,
        miss:0,
        hitWords:[],
        missWords:[]
      }
    ));
    tIndex=-1; tHide=false; turn=0; roundActive=false; timerExpired=false;
    renderScore();
    updateTurnHeader();
    resetWordView();
    setRoundControlsEnabled(false);
    clearInterval(tTimerId); tTimerId=null;
    if (ts.timerToggle.checked){
      tUI.tBox.style.display='inline-flex';
      tRemain = ts.time;
      tUI.tLabel.textContent = `${pad(Math.floor(tRemain/60))}:${pad(tRemain%60)}`;
    }else{
      tUI.tBox.style.display='none';
    }
    if (tUI.startRound){
      tUI.startRound.style.display='inline-flex';
      tUI.startRound.disabled=false;
    }
    if (tUI.endRound){
      tUI.endRound.style.display='none';
    }
    const currentName = teams[turn]?.name || defaultTeamName(turn);
    preRoundMessage(currentName, true);
    show('viewTeamGame');
  }
  $('#startTeam').onclick = startTeamGame;

  function beginRound(){
    if (roundActive) return;
    roundActive=true;
    timerExpired=false;
    setRoundControlsEnabled(true);
    if (tUI.startRound){
      tUI.startRound.style.display='none';
    }
    if (tUI.endRound){
      tUI.endRound.style.display='inline-flex';
      tUI.endRound.disabled=false;
    }
    const currentName = teams[turn]?.name || defaultTeamName(turn);
    setStatus(`–•–æ–¥ –∫–æ–º–∞–Ω–¥—ã ¬´${currentName}¬ª`);
    clearInterval(tTimerId); tTimerId=null;
    if (ts.timerToggle.checked){
      tUI.tBox.style.display='inline-flex';
      tRemain = ts.time;
      tUI.tLabel.textContent = `${pad(Math.floor(tRemain/60))}:${pad(tRemain%60)}`;
      tTimerId = setInterval(()=>{
        tRemain--;
        if (tRemain <= 0){
          clearInterval(tTimerId); tTimerId=null;
          tUI.tLabel.textContent = '00:00';
          handleTimerEnd();
        }else{
          tUI.tLabel.textContent = `${pad(Math.floor(tRemain/60))}:${pad(tRemain%60)}`;
        }
      },1000);
    }else{
      tUI.tBox.style.display='none';
    }
    advanceWord();
  }

  function handleTimerEnd(){
    if (!roundActive || timerExpired) return;
    timerExpired=true;
    playBuzz();
    setStatus('–í—Ä–µ–º—è –≤—ã—à–ª–æ! –ó–∞–≤–µ—Ä—à–∏—Ç–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–ó–∞–∫–æ–Ω—á–∏—Ç—å¬ª.');
    if (tUI.next) tUI.next.disabled = true;
  }

  function lockFinalActions(){
    if (tUI.hit) tUI.hit.disabled = true;
    if (tUI.skip) tUI.skip.disabled = true;
  }

  function finishRound(){
    if (!roundActive) return;
    clearInterval(tTimerId); tTimerId=null;
    roundActive=false;
    timerExpired=false;
    setRoundControlsEnabled(false);
    if (tUI.endRound){
      tUI.endRound.style.display='none';
    }
    if (tUI.startRound){
      tUI.startRound.style.display='inline-flex';
      tUI.startRound.disabled=false;
    }
    const nextIndex = (turn + 1) % teams.length;
    const nextName = teams[nextIndex]?.name || defaultTeamName(nextIndex);
    turn = nextIndex;
    updateTurnHeader();
    preRoundMessage(nextName, false);
    resetWordView();
    if (ts.timerToggle.checked){
      tUI.tBox.style.display='inline-flex';
      tRemain = ts.time;
      tUI.tLabel.textContent = `${pad(Math.floor(tRemain/60))}:${pad(tRemain%60)}`;
    }else{
      tUI.tBox.style.display='none';
    }
  }

  function declareWinner(team){
    clearInterval(tTimerId); tTimerId=null;
    roundActive=false;
    timerExpired=false;
    alert('–ü–æ–±–µ–¥–∞: ' + team.name);
    show('viewMenu');
  }

  if (tUI.startRound){
    tUI.startRound.onclick = beginRound;
  }
  if (tUI.endRound){
    tUI.endRound.onclick = finishRound;
  }

  tUI.next.onclick = ()=>{
    if (!roundActive || timerExpired) return;
    advanceWord();
  };
  tUI.hideBtn.onclick = ()=>{
    if (!roundActive || tIndex<0) return;
    tHide = !tHide;
    tUI.word.textContent = tHide ? '‚Ä¢‚Ä¢‚Ä¢' : tWords[tIndex];
    tUI.hideBtn.textContent = tHide ? '–ü–æ–∫–∞–∑–∞—Ç—å —Å–ª–æ–≤–æ' : '–°–∫—Ä—ã—Ç—å —Å–ª–æ–≤–æ';
  };
  tUI.meaning.onclick = ()=>{
    if (!roundActive || tIndex<0) return;
    window.open('https://ru.wikipedia.org/wiki/'+encodeURIComponent(tWords[tIndex]), '_blank');
  };

  if (tUI.statsBtn){
    tUI.statsBtn.onclick = ()=>{
      if (!teams.length){
        alert('–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫–∞ –ø—É—Å—Ç–∞');
        return;
      }
      const blocks = teams.map((team, idx)=>{
        const name = team.name || defaultTeamName(idx);
        const hitList = Array.isArray(team.hitWords) ? team.hitWords : [];
        const missList = Array.isArray(team.missWords) ? team.missWords : [];
        return `–ö–æ–º–∞–Ω–¥–∞ ¬´${name}¬ª\n–£–≥–∞–¥–∞–Ω–Ω—ã–µ (${hitList.length}):\n${formatWordList(hitList)}\n\n–ü—Ä–æ–ø—É—â–µ–Ω–Ω—ã–µ (${missList.length}):\n${formatWordList(missList)}`;
      });
      alert(`–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–∞–Ω–¥\n\n${blocks.join('\n\n')}`);
    };
  }

  tUI.hit.onclick = ()=>{
    if (!roundActive) return;
    const current = tWords[tIndex];
    if (current) teams[turn].hitWords.push(current);
    teams[turn].hit++; teams[turn].points++;
    renderScore();
    if (ts.ptsToggle.checked && teams[turn].points >= ts.pts){
      declareWinner(teams[turn]);
      return;
    }
    if (timerExpired){
      lockFinalActions();
      return;
    }
    advanceWord();
  };
  tUI.skip.onclick = ()=>{
    if (!roundActive) return;
    const current = tWords[tIndex];
    if (current) teams[turn].missWords.push(current);
    teams[turn].miss++; teams[turn].points--;
    renderScore();
    if (timerExpired){
      lockFinalActions();
      return;
    }
    advanceWord();
  };


  // Helpers
  const escapeHtml = str => str
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#39;');
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }

  // initial
  show('viewMenu');
</script>
</body>
</html>
