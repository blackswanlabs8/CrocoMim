<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>КрокоМим</title>
  <style>
    :root{
      --bg:#0f172a;            /* slate-900 */
      --panel:#111827;         /* gray-900 */
      --panel-2:#1f2937;       /* gray-800 */
      --accent:#22c55e;        /* green-500 */
      --accent-2:#16a34a;      /* green-600 */
      --muted:#94a3b8;         /* slate-400 */
      --text:#e5e7eb;          /* gray-200 */
      --text-strong:#f8fafc;   /* slate-50 */
      --danger:#ef4444;        /* red-500 */
      --warning:#f59e0b;       /* amber-500 */
      --card:#0b1223;          /* dark card */
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 10% -10%, #11203d 0%, transparent 60%),
                  radial-gradient(1300px 900px at 110% 10%, #082631 0%, transparent 55%),
                  var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Noto Color Emoji;
      line-height:1.5;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .app{
      width:min(960px, 96vw);
      min-height:88vh;
      backdrop-filter:saturate(120%) blur(8px);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)) , rgba(12,18,34,.65);
      border:1px solid rgba(255,255,255,.06);
      border-radius:24px;
      box-shadow:var(--shadow);
      padding:20px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    /* Header */
    .header{
      display:grid;
      grid-template-columns:48px 1fr 48px;
      align-items:center;
    }
    .icon-btn{
      width:40px;height:40px;border-radius:12px;
      display:flex;align-items:center;justify-content:center;
      background:var(--panel-2);
      border:1px solid rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
      transition:transform .1s ease, background .2s ease;
      user-select:none;
    }
    .icon-btn:hover{ background:#263141 }
    .icon-btn:active{ transform:scale(.96) }
    .title{
      text-align:center;
      font-weight:800;
      letter-spacing:.4px;
      color:var(--text-strong);
      font-size:clamp(20px, 3vw, 28px);
    }

    /* Sections & cards */
    .section{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.06);
      border-radius:var(--radius);
      padding:16px;
    }
    .section h2{
      margin:0 0 12px 0;
      font-size:18px;color:#cbd5e1;font-weight:700;
    }
    .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center }
    .stack{ display:flex; flex-direction:column; gap:12px }
    .grow{ flex:1 1 0 }

    /* Buttons */
    .btn{
      background:var(--accent);
      color:#07130c;
      font-weight:700;
      padding:12px 16px;
      border:none;border-radius:14px;
      cursor:pointer;
      box-shadow:0 6px 16px rgba(34,197,94,.25);
      transition:transform .08s ease, box-shadow .2s ease, background .2s ease;
      user-select:none;
    }
    .btn:hover{ background:var(--accent-2) }
    .btn:active{ transform:translateY(1px) }
    .btn.ghost{
      background:transparent;color:var(--text);
      border:1px solid rgba(255,255,255,.08);
      box-shadow:none;
    }
    .btn.warn{ background:var(--warning); color:#211a05 }
    .btn.danger{ background:var(--danger); color:#280707 }

    /* Inputs */
    .select,.input{
      min-height:44px;
      padding:10px 12px;
      border-radius:12px;
      background:var(--panel-2);
      color:var(--text);
      border:1px solid rgba(255,255,255,.06);
      outline:none;
    }
    .select{ width:100% }
    .chip{
      padding:8px 12px;border-radius:999px;
      background:#22304a;border:1px solid rgba(255,255,255,.06);color:#cbd5e1
    }

    /* Word card */
    .word-card{
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02)), var(--card);
      border:1px solid rgba(255,255,255,.08);
      border-radius:22px;
      padding:28px 20px;
      text-align:center;
      box-shadow:var(--shadow);
    }
    .word{
      font-size:clamp(28px, 6.5vw, 52px);
      font-weight:800;
      letter-spacing:.5px;
      color:#f1f5f9;
      word-break:break-word;
    }
    .muted{ color:var(--muted); font-size:14px }
    .kbd{ background:#1a2236;border:1px solid rgba(255,255,255,.08);border-radius:6px;padding:2px 6px;font-family:ui-monospace, SFMono-Regular, Menlo, monospace }

    .grid-3{
      display:grid; gap:10px;
      grid-template-columns:repeat(3, minmax(0,1fr));
    }
    .team-grid{
      display:grid;
      gap:16px;
      grid-template-columns:repeat(auto-fit, minmax(220px, 1fr));
    }
    .team-card{
      display:flex;
      gap:14px;
      align-items:flex-start;
      flex-wrap:wrap;
    }
    .team-avatar{
      width:96px;
      height:96px;
      border-radius:20px;
      border:none;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:42px;
      background-size:cover;
      background-position:center;
      color:#0b0b0b;
      cursor:pointer;
      box-shadow:0 6px 16px rgba(15,23,42,.35);
      transition:transform .08s ease;
      flex:0 0 auto;
    }
    .team-avatar span{ filter:drop-shadow(0 2px 4px rgba(0,0,0,.45)); }
    .team-avatar:active{ transform:scale(.97); }
    .team-body{
      flex:1;
      display:flex;
      flex-direction:column;
      gap:10px;
    }
    .team-name{
      font-size:18px;
      font-weight:700;
      color:var(--text-strong);
    }
    .team-edit{ align-self:flex-start; }
    .team-icon-grid{
      display:grid;
      gap:8px;
      grid-template-columns:repeat(auto-fit, minmax(48px, 1fr));
    }
    .team-icon-option{
      height:48px;
      border-radius:14px;
      border:1px solid transparent;
      display:flex;
      align-items:center;
      justify-content:center;
      background:rgba(255,255,255,.08);
      color:#fff;
      cursor:pointer;
      transition:transform .08s ease, border .2s ease, background .2s ease;
    }
    .team-icon-option span{ font-size:22px; }
    .team-icon-option.active{
      border-color:var(--accent);
      background:rgba(34,197,94,.18);
    }
    .team-icon-option:active{ transform:scale(.95); }
    .team-chip{ display:flex; align-items:center; gap:8px; }
    .team-chip-icon{ font-size:20px; line-height:1; }
    #turnTeamName{ display:inline-flex; align-items:center; gap:6px; }
    .chip input[type="checkbox"]{ margin-right:6px; accent-color:var(--accent); }
    .footer{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
      margin-top:auto;
    }
    @media (max-width:600px){
      .grid-3{ grid-template-columns:1fr }
      .header{ grid-template-columns:44px 1fr 44px }
    }
  </style>
</head>
<body>
<div class="app" id="app">

  <!-- HEADER -->
  <div class="header">
    <div class="icon-btn" id="btnBack" title="Назад в меню" aria-label="Назад">←</div>
    <div class="title">КрокоМим</div>
    <div class="icon-btn" id="btnHelp" title="Справка" aria-label="Справка">？</div>
  </div>

  <!-- MAIN VIEWS -->
  <div id="viewMenu" class="stack">
    <div class="section">
      <h2>Режимы игры</h2>
      <div class="stack">
        <button class="btn" id="menuQuickPlay">Начать быструю игру</button>
        <button class="btn ghost" id="goQuick">Настроить быстрый режим</button>
        <button class="btn ghost" id="goTeam">Командный режим</button>
      </div>
    </div>
  </div>

  <!-- QUICK SETTINGS -->
  <div id="viewQuickSetup" class="stack" style="display:none">
    <div class="section">
      <h2>Словарь</h2>
      <select class="select" id="quickDict">
        <option value="easy">Лёгкий</option>
        <option value="medium">Средний</option>
        <option value="hard">Сложный</option>
        <option value="films_series">Фильмы и сериалы</option>
        <option value="geography">География</option>
        <option value="kids">Детский</option>
        <option value="custom">Свой словарь</option>
      </select>
      <div id="quickCustomBox" class="stack" style="display:none; margin-top:10px">
        <label class="muted">Вставьте слова через запятую или перенос строки</label>
        <textarea class="input" id="quickCustomWords" rows="4" placeholder="яблоко, корабль, радуга..."></textarea>
      </div>
    </div>

    <div class="section">
      <h2>Таймер</h2>
      <div class="row">
        <label class="chip"><input type="checkbox" id="quickTimerToggle"> С таймером</label>
        <div class="row">
          <button class="btn ghost" id="quickTimeMinus">− 30с</button>
          <div class="chip" id="quickTimeLabel">60 c</div>
          <button class="btn ghost" id="quickTimePlus">+ 30с</button>
        </div>
      </div>
      <div class="muted" style="margin-top:8px">Шаг изменения времени: <span class="kbd">30с</span></div>
    </div>

    <!-- Важно: в Быстром режиме настройка очков до победы УДАЛЕНА -->

    <div class="footer">
      <button class="btn" id="startQuick">Начать игру</button>
    </div>
  </div>

  <!-- QUICK GAME -->
  <div id="viewQuickGame" class="stack" style="display:none">
    <div class="section row">
      <div class="chip">Угадано: <span id="qHit">0</span></div>
      <div class="chip">Пропущено: <span id="qMiss">0</span></div>
      <div class="chip" id="qTimerBox" style="display:none">⏱ <span id="qTimer">00:00</span></div>
    </div>

    <div class="word-card">
      <div id="qWord" class="word">—</div>
    </div>

    <!-- Кнопки под словом в 2 строки по требованию -->
    <div class="section">
      <div class="grid-3">
        <button class="btn ghost" id="qNext">Следующее слово</button>
        <button class="btn" id="qHitBtn">Угадано</button>
        <button class="btn warn" id="qSkipBtn">Пропустить</button>
      </div>
      <div class="stack" style="margin-top:10px">
        <button class="btn ghost" id="qHideBtn">Скрыть слово</button>
        <button class="btn ghost" id="qMeaningBtn">Значение слова (Википедия)</button>
      </div>
    </div>
  </div>

  <!-- TEAM SETTINGS -->
  <div id="viewTeamSetup" class="stack" style="display:none">
    <div class="section">
      <h2>Команды</h2>
      <div id="teamList" class="team-grid"></div>
      <div class="row">
        <button class="btn ghost" id="teamAdd">+ Добавить команду</button>
      </div>
    </div>

    <div class="section">
      <h2>Словарь</h2>
      <select class="select" id="teamDict">
        <option value="easy">Лёгкий</option>
        <option value="medium">Средний</option>
        <option value="hard">Сложный</option>
        <option value="films_series">Фильмы и сериалы</option>
        <option value="geography">География</option>
        <option value="kids">Детский</option>
        <option value="custom">Свой словарь</option>
      </select>
      <div id="teamCustomBox" class="stack" style="display:none; margin-top:10px">
        <label class="muted">Вставьте слова через запятую или перенос строки</label>
        <textarea class="input" id="teamCustomWords" rows="4" placeholder="яблоко, корабль, радуга..."></textarea>
      </div>
    </div>

    <div class="section">
      <h2>Таймер и очки до победы</h2>
      <div class="stack">
        <div class="row">
          <label class="chip"><input type="checkbox" id="teamTimerToggle"> С таймером</label>
          <button class="btn ghost" id="teamTimeMinus">− 30с</button>
          <div class="chip" id="teamTimeLabel">60 c</div>
          <button class="btn ghost" id="teamTimePlus">+ 30с</button>
        </div>
        <div class="row" style="flex-wrap:wrap; align-items:center; gap:12px">
          <label class="chip"><input type="checkbox" id="teamPtsToggle" checked> Победа по очкам</label>
          <div class="row" id="ptsControls">
            <span class="chip">Очки до победы</span>
            <button class="btn ghost" id="ptsMinus">−</button>
            <div class="chip" id="ptsLabel">10</div>
            <button class="btn ghost" id="ptsPlus">+</button>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <button class="btn" id="startTeam">Начать игру</button>
    </div>
  </div>

  <!-- TEAM GAME -->
  <div id="viewTeamGame" class="stack" style="display:none">
    <div class="section">
      <div class="row" style="justify-content:space-between; align-items:center">
        <div class="chip">Ход: <strong id="turnTeamName">Команда 1</strong></div>
        <div class="chip" id="tTimerBox" style="display:none">⏱ <span id="tTimer">00:00</span></div>
      </div>
      <div id="scoreTable" class="stack" style="margin-top:10px"></div>
    </div>

    <div class="word-card">
      <div id="tWord" class="word">—</div>
    </div>

    <div class="section">
      <div class="grid-3">
        <button class="btn ghost" id="tNext">Следующее слово</button>
        <button class="btn" id="tHitBtn">Угадано</button>
        <button class="btn warn" id="tSkipBtn">Пропустить</button>
      </div>
      <div class="stack" style="margin-top:10px">
        <button class="btn ghost" id="tHideBtn">Скрыть слово</button>
        <button class="btn ghost" id="tMeaningBtn">Значение слова (Википедия)</button>
      </div>
    </div>
  </div>

  <!-- FOOTER (опц.) -->
  <div class="footer" id="globalFooter" style="display:none"></div>
</div>

<script>
  // --- Utilities & state ---
  const $ = sel => document.querySelector(sel);
  let screen = 'menu';
  let qTimerId = null;
  let tTimerId = null;
  const backBtn = $('#btnBack');
  const helpBtn = $('#btnHelp');

  const DICTS = {
    easy:["дом","кот","собака","мяч","стол","стул","окно","дверь","машина","ручка","карандаш","тетрадь","лампа","книга","телефон","чашка","тарелка","ложка","вилка","нож","яблоко","банан","хлеб","сыр","молоко","чай","кофе","сок","вода","рыба","соль","сахар","масло","яйцо","ботинки","шапка","куртка","зонт","очки","часы","футбол","велосипед","рюкзак","карта","ключ","замок","мост","улица","парк","пальто","свитер","носки","перчатки","шарф","поезд","автобус","самолёт","корабль","дерево","цветок","трава","река","море","гора","облако","солнце","луна","звезда","дождь","снег","ветер","гром","молния","песок","пляж","печенье","торт","конфета","шоколад","мороз","тепло","холод","лето","осень","зима","весна","сумка","кресло","диван","кровать","подушка","одеяло","ковёр","полка","доска","дверца"],
    medium:["музыкант","танцор","художник","актёр","режиссёр","библиотека","музей","театр","кино","концерт","оркестр","скрипка","труба","барабан","пианино","клавиатура","компьютер","принтер","интернет","браузер","переводчик","инженер","архитектор","строитель","механик","пилот","почтальон","повар","пекарь","парашют","компас","микрофон","телескоп","микроскоп","маскарад","портрет","скульптура","карикатура","иллюстрация","маршрут","комета","планета","галактика","спутник","космодром","ракета","астронавт","гравитация","марафон","эстафета","трек","полоса","скейтборд","самокат","ролики","каноэ","парус","якорь","навигатор","перекрёсток","пешеход","светофор","переход","эскалатор","турникет","диалект","сценарий","метафора","ирония","аллегория","парадокс","формула","теорема","переменная","уравнение","фотосинтез","диаграмма","график","алгоритм","архив","протокол","сервер","клиент","пароль","шифр","волонтёр","ярмарка","праздник","фестиваль","капитан","команда","стратегия","тактика","капля","узор"],
    hard:["амбивалентность","конформизм","парадигма","катарсис","энтропия","апофения","идентификация","диссоциация","консенсус","редукционизм","рефлексия","онтология","эвристика","герменевтика","персистентность","импликация","дедукция","индукция","супрематизм","синергия","палиндром","оксюморон","метаморфоза","категоричность","диахрония","синекдоха","аллитерация","перфекционизм","преференция","когезия","когерентность","субстанция","трансцендентность","имманентность","телеметрия","релятивизм","экстраполяция","интерполяция","комбинаторика","аксиома","лемма","корреляция","деконструкция","репликация","квантификация","интерференция","флуктуация","суперпозиция","идемпотентность","асимптота","дифференциация","интеграция","дисперсия","конфабуляция","экспликация","импеданс","резистивность","индуктивность","аберрация","адиабатический","энтальпия","инвариант","аппроксимация","агрегация","аналогия","антиномия","апофеоз","конгруэнтность","конкатенация","идентификатор","криптография","стохастика","гомоморфизм","изоморфизм","биекция","диффузия","конденсация","сублимация","адсорбция","десорбция","термодинамика","катализ","ингибитор","рекурсия","итерация","регрессия","марковская цепь","градиент","дивергенция","лапласиан","кумулятивный","персистентный"],
    films_series:["Титаник","Аватар","Матрица","Интерстеллар","Начало","Темный рыцарь","Джокер","Властелин колец","Хоббит","Гарри Поттер","Звёздные войны","Мандалорец","Игра престолов","Дом дракона","Ведьмак","Шерлок","Доктор Хаус","Друзья","Теория большого взрыва","Офис","Побег из Шоушенка","Зелёная миля","Форрест Гамп","1+1","Ла-ла-ленд","Крестный отец","Таксист","Остров проклятых","Бойцовский клуб","Семь","Криминальное чтиво","Кил Билл","Однажды в Голливуде","Дюна","Бегущий по лезвию","Чужой","Хищник","Терминатор","Робокоп","Человек-паук","Железный человек","Мстители","Капитан Америка","Тор","Черная пантера","Стражи Галактики","Дэдпул","Локи","Во все тяжкие","Лучше звоните Солу","Наркос","Пикки Блайндерс","Викинги","Чёрное зеркало","Очень странные дела","Король Лев","Алладин","Холодное сердце","Тайна Коко","История игрушек","Рататуй","ВАЛЛ·И","Вверх","Головоломка","Моана","Пираты Карибского моря","Индиана Джонс","Миссия невыполнима","Джеймс Бонд","Шрек","Мадагаскар","Кунг-фу Панда","Как приручить дракона","Гладиатор","Троя","300 спартанцев","Храброе сердце","Марсианин","Выживший","Большой куш","Карты, деньги, два ствола","Достать ножи","Кингсман","Джентльмены","Аркейн","Кобра Кай","Сотня","Колесо времени","Фауда","Офис (UK)"],
    geography:["Европа","Азия","Африка","Северная Америка","Южная Америка","Австралия","Антарктида","Россия","Москва","Санкт-Петербург","США","Вашингтон","Нью-Йорк","Лос-Анджелес","Канада","Оттава","Торонто","Мексика","Бразилия","Рио-де-Жанейро","Аргентина","Буэнос-Айрес","Чили","Перу","Лима","Колумбия","Богота","Германия","Берлин","Франция","Париж","Испания","Мадрид","Италия","Рим","Милан","Венеция","Пиза","Греция","Афины","Великобритания","Лондон","Норвегия","Швеция","Стокгольм","Финляндия","Хельсинки","Дания","Копенгаген","Исландия","Рейкьявик","Польша","Варшава","Чехия","Прага","Австрия","Вена","Швейцария","Цюрих","Нидерланды","Амстердам","Бельгия","Брюссель","Португалия","Лиссабон","Турция","Стамбул","Анкара","Египет","Каир","Марокко","Рабат","Южная Африка","Кейптаун","Нигерия","Абуджа","Кения","Найроби","Эфиопия","Аддис-Абеба","Израиль","Иерусалим","Иордания","Амман","Саудовская Аравия","Эр-Рияд","ОАЭ","Дубай","Индия","Дели","Мумбаи","Непал","Катманду","Китай","Пекин","Великая китайская стена"],
    kids:["мяч","кукла","мишка","зайчик","солнышко","облако","радуга","снежинка","санки","варежки","шапка","шарф","машинка","паровоз","поезд","самолёт","ракета","лодка","парус","велосипед","самокат","качели","горка","карусель","зоопарк","цирк","парк","игрушка","конструктор","кубики","пазл","раскраска","фломастер","карандаш","кисточка","краски","пластилин","ножницы","клей","книжка","сказка","песня","танец","музыка","праздник","подарок","шарик","торт","свечи","печенье","конфета","шоколад","мороженое","яблоко","банан","груша","апельсин","клубника","вишня","арбуз","дыня","морковь","огурец","помидор","суп","каша","котёнок","щенок","хомяк","рыбка","черепаха","лягушка","утёнок","слон","жираф","лев","тигр","зебра","панда","домик","кроватка","подушка","одеяло","ванна","мыло","щётка","паста","полотенце","коляска","мама","папа","бабушка","дедушка","брат","сестра","друг","подруга","прятки","салочки"]
  };

  const TEAM_ICONS = [
    {id:'sun', emoji:'🌞', bg:'linear-gradient(135deg,#fde047,#f97316)', color:'#1f2937'},
    {id:'rocket', emoji:'🚀', bg:'linear-gradient(135deg,#60a5fa,#2563eb)', color:'#0f172a'},
    {id:'leaf', emoji:'🍀', bg:'linear-gradient(135deg,#86efac,#22c55e)', color:'#052e16'},
    {id:'wave', emoji:'🐬', bg:'linear-gradient(135deg,#67e8f9,#0ea5e9)', color:'#0f172a'},
    {id:'crown', emoji:'👑', bg:'linear-gradient(135deg,#fcd34d,#a855f7)', color:'#312e81'},
    {id:'gamepad', emoji:'🎮', bg:'linear-gradient(135deg,#f472b6,#a855f7)', color:'#1e1b4b'},
    {id:'bolt', emoji:'⚡', bg:'linear-gradient(135deg,#f97316,#ef4444)', color:'#111827'},
    {id:'snow', emoji:'❄️', bg:'linear-gradient(135deg,#bfdbfe,#60a5fa)', color:'#1e3a8a'}
  ];
  const defaultTeamName = idx => `Команда ${idx+1}`;
  const makeTeam = (name, icon) => ({name, icon, points:0, hit:0, miss:0});
  const getTeamIcon = id => TEAM_ICONS.find(icon=>icon.id===id) || TEAM_ICONS[0];
  let audioCtx = null;
  function playBuzz(){
    try{
      const AudioCtx = window.AudioContext || window.webkitAudioContext;
      if (!AudioCtx) return;
      if (!audioCtx) audioCtx = new AudioCtx();
      if (audioCtx.state === 'suspended') audioCtx.resume();
      const duration = 0.35;
      const sampleRate = audioCtx.sampleRate;
      const buffer = audioCtx.createBuffer(1, sampleRate * duration, sampleRate);
      const data = buffer.getChannelData(0);
      for (let i=0;i<data.length;i++){
        const progress = i / data.length;
        data[i] = (Math.random()*2 - 1) * (1 - progress) * 0.7;
      }
      const noise = audioCtx.createBufferSource();
      noise.buffer = buffer;
      const gain = audioCtx.createGain();
      gain.gain.setValueAtTime(0.5, audioCtx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
      noise.connect(gain).connect(audioCtx.destination);
      noise.start();
    }catch(err){ /* ignore playback errors */ }
  }

  // Navigation
  const show = v => {
    ['viewMenu','viewQuickSetup','viewQuickGame','viewTeamSetup','viewTeamGame'].forEach(id=>$('#'+id).style.display='none');
    $('#'+v).style.display='flex';
    screen = v;
    if (v==='viewMenu'){
      backBtn.style.visibility = 'hidden';
      backBtn.style.pointerEvents = 'none';
    }else{
      backBtn.style.visibility = 'visible';
      backBtn.style.pointerEvents = 'auto';
    }
  };

  // Header buttons
  backBtn.onclick = () => {
    if (screen==='viewQuickGame' || screen==='viewTeamGame'){
      if (!confirm('Выйти в меню? Текущая партия будет завершена.')) return;
    }
    if (typeof qTimerId !== 'undefined'){ clearInterval(qTimerId); qTimerId=null; }
    if (typeof tTimerId !== 'undefined'){ clearInterval(tTimerId); tTimerId=null; }
    show('viewMenu');
  };
  helpBtn.onclick = () => {
    alert('КрокоМим — объясните слово жестами/мимикой. Кнопки: Угадано, Пропустить, Следующее; можно скрыть/показать слово и открыть значение на Википедии. Удачи!');
  };

  const menuQuickBtn = $('#menuQuickPlay');

  // Menu to setups
  $('#goQuick').onclick = () => show('viewQuickSetup');
  $('#goTeam').onclick = () => {
    ensureTeamsSeed();
    renderTeams();
    show('viewTeamSetup');
  };

  // Quick setup
  const qs = {
    dict: $('#quickDict'),
    customBox: $('#quickCustomBox'),
    customText: $('#quickCustomWords'),
    timerToggle: $('#quickTimerToggle'),
    time: 60,
    timeMinus: $('#quickTimeMinus'),
    timePlus: $('#quickTimePlus'),
    timeLabel: $('#quickTimeLabel'),
    start: $('#startQuick')
  };
  const upQuickTime = () => qs.timeLabel.textContent = qs.time+' c';
  upQuickTime();
  qs.timeMinus.onclick = () => { qs.time = Math.max(30, qs.time-30); upQuickTime(); };
  qs.timePlus.onclick = () => { qs.time += 30; upQuickTime(); };
  qs.dict.onchange = () => qs.customBox.style.display = (qs.dict.value==='custom')?'block':'none';

  menuQuickBtn.onclick = () => {
    qs.dict.value = 'easy';
    qs.dict.dispatchEvent(new Event('change'));
    qs.timerToggle.checked = true;
    qs.time = 60;
    upQuickTime();
    startQuickGame();
  };

  // Quick game state
  let qWords=[], qIndex=0, qHide=false, qRemain=0, qHit=0, qMiss=0;

  const qUI = {
    word: $('#qWord'),
    hit: $('#qHit'), miss: $('#qMiss'),
    next: $('#qNext'), hitBtn: $('#qHitBtn'), skipBtn: $('#qSkipBtn'),
    hideBtn: $('#qHideBtn'), meaningBtn: $('#qMeaningBtn'),
    tBox: $('#qTimerBox'), tLabel: $('#qTimer')
  };

  const pad = n => String(n).padStart(2,'0');

  function startQuickGame(){
    // build words
    if (qs.dict.value==='custom'){
      const raw = qs.customText.value || '';
      qWords = raw.split(/(?:,|\n)+/).map(s=>s.trim()).filter(Boolean);
    }else{
      qWords = [...DICTS[qs.dict.value]];
    }
    if (qWords.length===0){ alert('Добавьте хотя бы одно слово'); return; }
    shuffle(qWords);
    qIndex=0; qHide=false; qHit=0; qMiss=0;
    qUI.hit.textContent = '0'; qUI.miss.textContent = '0';
    qUI.word.textContent = qWords[qIndex];
    qUI.hideBtn.textContent = 'Скрыть слово';

    // timer
    clearInterval(qTimerId); qTimerId=null;
    if (qs.timerToggle.checked){
      qUI.tBox.style.display='inline-flex';
      qRemain = qs.time;
      qUI.tLabel.textContent = `${pad(Math.floor(qRemain/60))}:${pad(qRemain%60)}`;
      qTimerId = setInterval(()=>{
        qRemain--;
        qUI.tLabel.textContent = `${pad(Math.floor(qRemain/60))}:${pad(qRemain%60)}`;
        if (qRemain<=0){
          clearInterval(qTimerId); qTimerId=null;
          playBuzz();
          nextWord();
        }
      },1000);
    }else{
      qUI.tBox.style.display='none';
    }
    show('viewQuickGame');
  }
  $('#startQuick').onclick = startQuickGame;

  function nextWord(){
    qIndex = (qIndex+1) % qWords.length;
    qHide=false;
    qUI.word.textContent = qWords[qIndex];
    qUI.hideBtn.textContent = 'Скрыть слово';
  }

  qUI.next.onclick = nextWord;
  qUI.hitBtn.onclick = ()=>{ qHit++; qUI.hit.textContent=qHit; nextWord(); };
  qUI.skipBtn.onclick = ()=>{ qMiss++; qUI.miss.textContent=qMiss; nextWord(); };
  qUI.hideBtn.onclick = ()=>{
    qHide = !qHide;
    qUI.word.textContent = qHide ? '•••' : qWords[qIndex];
    qUI.hideBtn.textContent = qHide ? 'Показать слово' : 'Скрыть слово';
  };
  qUI.meaningBtn.onclick = ()=> window.open('https://ru.wikipedia.org/wiki/'+encodeURIComponent(qWords[qIndex]), '_blank');

  // Team setup & game
  let teams = [];
  function ensureTeamsSeed(){
    if (teams.length===0){
      teams = [
        makeTeam(defaultTeamName(0), TEAM_ICONS[0].id),
        makeTeam(defaultTeamName(1), TEAM_ICONS[1].id)
      ];
    } else {
      teams = teams.map((team, idx)=>({
        ...team,
        name: team.name || defaultTeamName(idx),
        icon: team.icon || TEAM_ICONS[idx % TEAM_ICONS.length].id,
        points: team.points ?? 0,
        hit: team.hit ?? 0,
        miss: team.miss ?? 0
      }));
    }
  }
  const teamList = $('#teamList');
  function renderTeams(){
    teamList.innerHTML='';
    teams.forEach((team, index)=>{
      if (!team.name) team.name = defaultTeamName(index);
      if (!team.icon) team.icon = TEAM_ICONS[index % TEAM_ICONS.length].id;
      const iconDef = getTeamIcon(team.icon);
      const card=document.createElement('div');
      card.className='section team-card';
      card.innerHTML = `
        <button class="team-avatar" type="button" data-i="${index}" data-action="cycle" style="background:${iconDef.bg};color:${iconDef.color}">
          <span>${iconDef.emoji}</span>
        </button>
        <div class="team-body">
          <div class="team-name">${escapeHtml(team.name)}</div>
          <button class="btn ghost team-edit" type="button" data-i="${index}" data-action="edit">Редактировать название</button>
          <div class="team-icon-grid">
            ${TEAM_ICONS.map(icon=>`
              <button class="team-icon-option ${icon.id===team.icon?'active':''}" type="button" data-i="${index}" data-icon="${icon.id}" style="background:${icon.bg};color:${icon.color}">
                <span>${icon.emoji}</span>
              </button>
            `).join('')}
          </div>
        </div>`;
      teamList.appendChild(card);
    });

    teamList.querySelectorAll('[data-action="edit"]').forEach(btn=>{
      btn.onclick = ()=>{
        const idx = +btn.dataset.i;
        const current = teams[idx].name;
        const next = prompt('Название команды', current);
        if (next===null) return;
        const trimmed = next.trim();
        teams[idx].name = trimmed || defaultTeamName(idx);
        renderTeams();
      };
    });
    teamList.querySelectorAll('.team-icon-option').forEach(btn=>{
      btn.onclick = ()=>{
        const idx = +btn.dataset.i;
        teams[idx].icon = btn.dataset.icon;
        renderTeams();
      };
    });
    teamList.querySelectorAll('[data-action="cycle"]').forEach(btn=>{
      btn.onclick = ()=>{
        const idx = +btn.dataset.i;
        const currentIcon = teams[idx].icon;
        const foundIndex = TEAM_ICONS.findIndex(icon=>icon.id===currentIcon);
        const nextIcon = TEAM_ICONS[(foundIndex+1)%TEAM_ICONS.length];
        teams[idx].icon = nextIcon.id;
        renderTeams();
      };
    });
  }
  $('#teamAdd').onclick = ()=>{
    const icon = TEAM_ICONS[teams.length % TEAM_ICONS.length].id;
    teams.push(makeTeam(defaultTeamName(teams.length), icon));
    renderTeams();
  };

  const ts = {
    dict: $('#teamDict'),
    customBox: $('#teamCustomBox'),
    customText: $('#teamCustomWords'),
    timerToggle: $('#teamTimerToggle'),
    time: 60,
    timeMinus: $('#teamTimeMinus'),
    timePlus: $('#teamTimePlus'),
    timeLabel: $('#teamTimeLabel'),
    ptsToggle: $('#teamPtsToggle'),
    ptsControls: $('#ptsControls'),
    pts: 10, ptsMinus: $('#ptsMinus'), ptsPlus: $('#ptsPlus'), ptsLabel: $('#ptsLabel')
  };
  const upTeamTime = () => ts.timeLabel.textContent = ts.time+' c';
  const upPts = () => ts.ptsLabel.textContent = ts.pts;
  upTeamTime(); upPts();
  ts.timeMinus.onclick = ()=>{ ts.time = Math.max(30, ts.time-30); upTeamTime(); };
  ts.timePlus.onclick = ()=>{ ts.time += 30; upTeamTime(); };
  ts.ptsMinus.onclick = ()=>{ ts.pts = Math.max(1, ts.pts-1); upPts(); };
  ts.ptsPlus.onclick = ()=>{ ts.pts += 1; upPts(); };
  ts.dict.onchange = ()=> ts.customBox.style.display = (ts.dict.value==='custom')?'block':'none';
  const updatePtsUI = ()=>{
    const enabled = ts.ptsToggle.checked;
    ts.ptsControls.style.display = enabled ? 'flex' : 'none';
  };
  ts.ptsToggle.onchange = updatePtsUI;
  updatePtsUI();

  // Team game state
  let tWords=[], tIndex=0, tHide=false, tRemain=0, turn=0;

  const tUI = {
    word: $('#tWord'),
    turnName: $('#turnTeamName'),
    tBox: $('#tTimerBox'), tLabel: $('#tTimer'),
    table: $('#scoreTable'),
    next: $('#tNext'), hit: $('#tHitBtn'), skip: $('#tSkipBtn'),
    hideBtn: $('#tHideBtn'), meaning: $('#tMeaningBtn')
  };

  function updateTurnHeader(){
    const iconDef = getTeamIcon(teams[turn].icon);
    tUI.turnName.innerHTML = `<span class="team-chip-icon">${iconDef.emoji}</span>${escapeHtml(teams[turn].name || defaultTeamName(turn))}`;
  }

  function renderScore(){
    tUI.table.innerHTML='';
    teams.forEach((team, idx)=>{
      const iconDef = getTeamIcon(team.icon);
      const row=document.createElement('div');
      row.className='row';
      row.innerHTML = `
        <div class="chip team-chip" style="min-width:160px">
          <span class="team-chip-icon">${iconDef.emoji}</span>
          ${escapeHtml(team.name || defaultTeamName(idx))}
        </div>
        <div class="chip">Угадано: ${team.hit}</div>
        <div class="chip">Пропущено: ${team.miss}</div>
        <div class="chip">Очки: ${team.points}</div>`;
      tUI.table.appendChild(row);
    });
  }

  function startTeamGame(){
    if (teams.length<2){ alert('Нужно минимум 2 команды'); return; }
    // build words
    if (ts.dict.value==='custom'){
      const raw = ts.customText.value || '';
      tWords = raw.split(/(?:,|\n)+/).map(s=>s.trim()).filter(Boolean);
    }else{
      tWords = [...DICTS[ts.dict.value]];
    }
    if (tWords.length===0){ alert('Добавьте хотя бы одно слово'); return; }
    shuffle(tWords);
    teams = teams.map((t, idx)=>({
      name: t.name || defaultTeamName(idx),
      icon: t.icon || TEAM_ICONS[idx % TEAM_ICONS.length].id,
      points:0, hit:0, miss:0
    }));
    tIndex=0; tHide=false; turn=0;
    tUI.word.textContent = tWords[tIndex];
    tUI.hideBtn.textContent = 'Скрыть слово';
    renderScore();
    updateTurnHeader();

    clearInterval(tTimerId); tTimerId=null;
    if (ts.timerToggle.checked){
      tUI.tBox.style.display='inline-flex';
      tRemain = ts.time;
      tUI.tLabel.textContent = `${pad(Math.floor(tRemain/60))}:${pad(tRemain%60)}`;
      tTimerId = setInterval(()=>{
        tRemain--;
        tUI.tLabel.textContent = `${pad(Math.floor(tRemain/60))}:${pad(tRemain%60)}`;
        if (tRemain<=0){
          clearInterval(tTimerId); tTimerId=null;
          playBuzz();
          nextTurn();
        }
      },1000);
    }else{
      tUI.tBox.style.display='none';
    }
    show('viewTeamGame');
  }
  $('#startTeam').onclick = startTeamGame;

  function nextTurn(){
    turn = (turn+1) % teams.length;
    updateTurnHeader();
    nextTeamWord();
    if (ts.timerToggle.checked){
      clearInterval(tTimerId); tRemain = ts.time;
      tUI.tLabel.textContent = `${pad(Math.floor(tRemain/60))}:${pad(tRemain%60)}`;
      tTimerId = setInterval(()=>{
        tRemain--;
        tUI.tLabel.textContent = `${pad(Math.floor(tRemain/60))}:${pad(tRemain%60)}`;
        if (tRemain<=0){
          clearInterval(tTimerId); tTimerId=null;
          playBuzz();
          nextTurn();
        }
      },1000);
    } else {
      clearInterval(tTimerId);
      tTimerId = null;
    }
  }
  function nextTeamWord(){
    tIndex = (tIndex+1) % tWords.length;
    tHide=false;
    tUI.word.textContent = tWords[tIndex];
    tUI.hideBtn.textContent = 'Скрыть слово';
  }

  tUI.next.onclick = nextTeamWord;
  tUI.hideBtn.onclick = ()=>{
    tHide = !tHide;
    tUI.word.textContent = tHide ? '•••' : tWords[tIndex];
    tUI.hideBtn.textContent = tHide ? 'Показать слово' : 'Скрыть слово';
  };
  tUI.meaning.onclick = ()=> window.open('https://ru.wikipedia.org/wiki/'+encodeURIComponent(tWords[tIndex]), '_blank');

  tUI.hit.onclick = ()=>{
    teams[turn].hit++; teams[turn].points++;
    renderScore();
    if (ts.ptsToggle.checked && teams[turn].points >= ts.pts){
      clearInterval(tTimerId); tTimerId=null;
      alert('Победа: ' + teams[turn].name);
      show('viewMenu');
      return;
    }
    nextTurn();
  };
  tUI.skip.onclick = ()=>{
    teams[turn].miss++; teams[turn].points--;
    renderScore();
    nextTurn();
  };

  // Helpers
  const escapeHtml = str => str
    .replace(/&/g,'&amp;')
    .replace(/</g,'&lt;')
    .replace(/>/g,'&gt;')
    .replace(/"/g,'&quot;')
    .replace(/'/g,'&#39;');
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }

  // initial
  show('viewMenu');
</script>
</body>
</html>
