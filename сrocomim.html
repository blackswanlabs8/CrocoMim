<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>КрокоМим</title>
  <style>
    :root{
      --bg:#0f172a;            /* slate-900 */
      --panel:#111827;         /* gray-900 */
      --panel-2:#1f2937;       /* gray-800 */
      --accent:#22c55e;        /* green-500 */
      --accent-2:#16a34a;      /* green-600 */
      --muted:#94a3b8;         /* slate-400 */
      --text:#e5e7eb;          /* gray-200 */
      --text-strong:#f8fafc;   /* slate-50 */
      --danger:#ef4444;        /* red-500 */
      --warning:#f59e0b;       /* amber-500 */
      --card:#0b1223;          /* dark card */
      --shadow:0 10px 30px rgba(0,0,0,.35);
      --radius:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background: radial-gradient(1200px 800px at 10% -10%, #11203d 0%, transparent 60%),
                  radial-gradient(1300px 900px at 110% 10%, #082631 0%, transparent 55%),
                  var(--bg);
      color:var(--text);
      font-family: ui-sans-serif, system-ui, Segoe UI, Roboto, Helvetica, Arial, Apple Color Emoji, Noto Color Emoji;
      line-height:1.5;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .app{
      width:min(960px, 96vw);
      min-height:88vh;
      backdrop-filter:saturate(120%) blur(8px);
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02)) , rgba(12,18,34,.65);
      border:1px solid rgba(255,255,255,.06);
      border-radius:24px;
      box-shadow:var(--shadow);
      padding:20px;
      display:flex;
      flex-direction:column;
      gap:16px;
    }
    /* Header */
    .header{
      display:grid;
      grid-template-columns:48px 1fr 48px;
      align-items:center;
    }
    .icon-btn{
      width:40px;height:40px;border-radius:12px;
      display:flex;align-items:center;justify-content:center;
      background:var(--panel-2);
      border:1px solid rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
      transition:transform .1s ease, background .2s ease;
      user-select:none;
    }
    .icon-btn:hover{ background:#263141 }
    .icon-btn:active{ transform:scale(.96) }
    .title{
      text-align:center;
      font-weight:800;
      letter-spacing:.4px;
      color:var(--text-strong);
      font-size:clamp(20px, 3vw, 28px);
    }

    /* Sections & cards */
    .section{
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01));
      border:1px solid rgba(255,255,255,.06);
      border-radius:var(--radius);
      padding:16px;
    }
    .section h2{
      margin:0 0 12px 0;
      font-size:18px;color:#cbd5e1;font-weight:700;
    }
    .row{ display:flex; gap:12px; flex-wrap:wrap; align-items:center }
    .stack{ display:flex; flex-direction:column; gap:12px }
    .grow{ flex:1 1 0 }

    /* Buttons */
    .btn{
      background:var(--accent);
      color:#07130c;
      font-weight:700;
      padding:12px 16px;
      border:none;border-radius:14px;
      cursor:pointer;
      box-shadow:0 6px 16px rgba(34,197,94,.25);
      transition:transform .08s ease, box-shadow .2s ease, background .2s ease;
      user-select:none;
    }
    .btn:hover{ background:var(--accent-2) }
    .btn:active{ transform:translateY(1px) }
    .btn.ghost{
      background:transparent;color:var(--text);
      border:1px solid rgba(255,255,255,.08);
      box-shadow:none;
    }
    .btn.warn{ background:var(--warning); color:#211a05 }
    .btn.danger{ background:var(--danger); color:#280707 }

    /* Inputs */
    .select,.input{
      min-height:44px;
      padding:10px 12px;
      border-radius:12px;
      background:var(--panel-2);
      color:var(--text);
      border:1px solid rgba(255,255,255,.06);
      outline:none;
    }
    .select{ width:100% }
    .chip{
      padding:8px 12px;border-radius:999px;
      background:#22304a;border:1px solid rgba(255,255,255,.06);color:#cbd5e1
    }

    /* Word card */
    .word-card{
      background:linear-gradient(180deg, rgba(255,255,255,.03), rgba(255,255,255,.02)), var(--card);
      border:1px solid rgba(255,255,255,.08);
      border-radius:22px;
      padding:28px 20px;
      text-align:center;
      box-shadow:var(--shadow);
    }
    .word{
      font-size:clamp(28px, 6.5vw, 52px);
      font-weight:800;
      letter-spacing:.5px;
      color:#f1f5f9;
      word-break:break-word;
    }
    .muted{ color:var(--muted); font-size:14px }
    .kbd{ background:#1a2236;border:1px solid rgba(255,255,255,.08);border-radius:6px;padding:2px 6px;font-family:ui-monospace, SFMono-Regular, Menlo, monospace }

    .grid-3{
      display:grid; gap:10px;
      grid-template-columns:repeat(3, minmax(0,1fr));
    }
    .footer{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:center;
      margin-top:auto;
    }
    @media (max-width:600px){
      .grid-3{ grid-template-columns:1fr }
      .header{ grid-template-columns:44px 1fr 44px }
    }
  </style>
</head>
<body>
<div class="app" id="app">

  <!-- HEADER -->
  <div class="header">
    <div class="icon-btn" id="btnBack" title="Назад в меню" aria-label="Назад">←</div>
    <div class="title">КрокоМим</div>
    <div class="icon-btn" id="btnHelp" title="Справка" aria-label="Справка">？</div>
  </div>

  <!-- MAIN VIEWS -->
  <div id="viewMenu" class="stack">
    <div class="section">
      <h2>Режимы игры</h2>
      <div class="stack">
        <button class="btn" id="goQuick">Быстрый</button>
        <button class="btn ghost" id="goTeam">Командный</button>
      </div>
    </div>
  </div>

  <!-- QUICK SETTINGS -->
  <div id="viewQuickSetup" class="stack" style="display:none">
    <div class="section">
      <h2>Словарь</h2>
      <select class="select" id="quickDict">
        <option value="easy">Лёгкий</option>
        <option value="medium">Средний</option>
        <option value="hard">Сложный</option>
        <option value="films_series">Фильмы и сериалы</option>
        <option value="geography">География</option>
        <option value="kids">Детский</option>
        <option value="custom">Свой словарь</option>
      </select>
      <div id="quickCustomBox" class="stack" style="display:none; margin-top:10px">
        <label class="muted">Вставьте слова через запятую или перенос строки</label>
        <textarea class="input" id="quickCustomWords" rows="4" placeholder="яблоко, корабль, радуга..."></textarea>
      </div>
    </div>

    <div class="section">
      <h2>Таймер</h2>
      <div class="row">
        <label class="chip"><input type="checkbox" id="quickTimerToggle"> С таймером</label>
        <div class="row">
          <button class="btn ghost" id="quickTimeMinus">− 30с</button>
          <div class="chip" id="quickTimeLabel">60 c</div>
          <button class="btn ghost" id="quickTimePlus">+ 30с</button>
        </div>
      </div>
      <div class="muted" style="margin-top:8px">Шаг изменения времени: <span class="kbd">30с</span></div>
    </div>

    <!-- Важно: в Быстром режиме настройка очков до победы УДАЛЕНА -->

    <div class="footer">
      <button class="btn" id="startQuick">Начать игру</button>
    </div>
  </div>

  <!-- QUICK GAME -->
  <div id="viewQuickGame" class="stack" style="display:none">
    <div class="section row">
      <div class="chip">Угадано: <span id="qHit">0</span></div>
      <div class="chip">Пропущено: <span id="qMiss">0</span></div>
      <div class="chip" id="qTimerBox" style="display:none">⏱ <span id="qTimer">00:00</span></div>
    </div>

    <div class="word-card">
      <div id="qWord" class="word">—</div>
    </div>

    <!-- Кнопки под словом в 2 строки по требованию -->
    <div class="section">
      <div class="grid-3">
        <button class="btn ghost" id="qNext">Следующее слово</button>
        <button class="btn" id="qHitBtn">Угадано</button>
        <button class="btn warn" id="qSkipBtn">Пропустить</button>
      </div>
      <div class="stack" style="margin-top:10px">
        <button class="btn ghost" id="qHideBtn">Скрыть слово</button>
        <button class="btn ghost" id="qMeaningBtn">Значение слова (Википедия)</button>
      </div>
    </div>
  </div>

  <!-- TEAM SETTINGS -->
  <div id="viewTeamSetup" class="stack" style="display:none">
    <div class="section">
      <h2>Команды</h2>
      <div id="teamList" class="row"></div>
      <div class="row">
        <button class="btn ghost" id="teamAdd">+ Добавить команду</button>
      </div>
    </div>

    <div class="section">
      <h2>Словарь</h2>
      <select class="select" id="teamDict">
        <option value="easy">Лёгкий</option>
        <option value="medium">Средний</option>
        <option value="hard">Сложный</option>
        <option value="films_series">Фильмы и сериалы</option>
        <option value="geography">География</option>
        <option value="kids">Детский</option>
        <option value="custom">Свой словарь</option>
      </select>
      <div id="teamCustomBox" class="stack" style="display:none; margin-top:10px">
        <label class="muted">Вставьте слова через запятую или перенос строки</label>
        <textarea class="input" id="teamCustomWords" rows="4" placeholder="яблоко, корабль, радуга..."></textarea>
      </div>
    </div>

    <div class="section">
      <h2>Таймер и очки до победы</h2>
      <div class="row">
        <label class="chip"><input type="checkbox" id="teamTimerToggle"> С таймером</label>
        <button class="btn ghost" id="teamTimeMinus">− 30с</button>
        <div class="chip" id="teamTimeLabel">60 c</div>
        <button class="btn ghost" id="teamTimePlus">+ 30с</button>
        <div class="grow"></div>
        <div class="row">
          <span class="chip">Очки до победы</span>
          <button class="btn ghost" id="ptsMinus">−</button>
          <div class="chip" id="ptsLabel">10</div>
          <button class="btn ghost" id="ptsPlus">+</button>
        </div>
      </div>
    </div>

    <div class="footer">
      <button class="btn" id="startTeam">Начать игру</button>
    </div>
  </div>

  <!-- TEAM GAME -->
  <div id="viewTeamGame" class="stack" style="display:none">
    <div class="section">
      <div class="row" style="justify-content:space-between; align-items:center">
        <div class="chip">Ход: <strong id="turnTeamName">Команда 1</strong></div>
        <div class="chip" id="tTimerBox" style="display:none">⏱ <span id="tTimer">00:00</span></div>
      </div>
      <div id="scoreTable" class="stack" style="margin-top:10px"></div>
    </div>

    <div class="word-card">
      <div id="tWord" class="word">—</div>
    </div>

    <div class="section">
      <div class="grid-3">
        <button class="btn ghost" id="tNext">Следующее слово</button>
        <button class="btn" id="tHitBtn">Угадано</button>
        <button class="btn warn" id="tSkipBtn">Пропустить</button>
      </div>
      <div class="stack" style="margin-top:10px">
        <button class="btn ghost" id="tHideBtn">Скрыть слово</button>
        <button class="btn ghost" id="tMeaningBtn">Значение слова (Википедия)</button>
      </div>
    </div>
  </div>

  <!-- FOOTER (опц.) -->
  <div class="footer" id="globalFooter" style="display:none"></div>
</div>

<script>
  // --- Utilities & state ---
  const $ = sel => document.querySelector(sel);
  let screen = 'menu';

  const DICTS = {
    easy:["дом","кот","собака","мяч","стол","стул","окно","дверь","машина","ручка","карандаш","тетрадь","лампа","книга","телефон","чашка","тарелка","ложка","вилка","нож","яблоко","банан","хлеб","сыр","молоко","чай","кофе","сок","вода","рыба","соль","сахар","масло","яйцо","ботинки","шапка","куртка","зонт","очки","часы","футбол","велосипед","рюкзак","карта","ключ","замок","мост","улица","парк","пальто","свитер","носки","перчатки","шарф","поезд","автобус","самолёт","корабль","дерево","цветок","трава","река","море","гора","облако","солнце","луна","звезда","дождь","снег","ветер","гром","молния","песок","пляж","печенье","торт","конфета","шоколад","мороз","тепло","холод","лето","осень","зима","весна","сумка","кресло","диван","кровать","подушка","одеяло","ковёр","полка","доска","дверца"],
    medium:["музыкант","танцор","художник","актёр","режиссёр","библиотека","музей","театр","кино","концерт","оркестр","скрипка","труба","барабан","пианино","клавиатура","компьютер","принтер","интернет","браузер","переводчик","инженер","архитектор","строитель","механик","пилот","почтальон","повар","пекарь","парашют","компас","микрофон","телескоп","микроскоп","маскарад","портрет","скульптура","карикатура","иллюстрация","маршрут","комета","планета","галактика","спутник","космодром","ракета","астронавт","гравитация","марафон","эстафета","трек","полоса","скейтборд","самокат","ролики","каноэ","парус","якорь","навигатор","перекрёсток","пешеход","светофор","переход","эскалатор","турникет","диалект","сценарий","метафора","ирония","аллегория","парадокс","формула","теорема","переменная","уравнение","фотосинтез","диаграмма","график","алгоритм","архив","протокол","сервер","клиент","пароль","шифр","волонтёр","ярмарка","праздник","фестиваль","капитан","команда","стратегия","тактика","капля","узор"],
    hard:["амбивалентность","конформизм","парадигма","катарсис","энтропия","апофения","идентификация","диссоциация","консенсус","редукционизм","рефлексия","онтология","эвристика","герменевтика","персистентность","импликация","дедукция","индукция","супрематизм","синергия","палиндром","оксюморон","метаморфоза","категоричность","диахрония","синекдоха","аллитерация","перфекционизм","преференция","когезия","когерентность","субстанция","трансцендентность","имманентность","телеметрия","релятивизм","экстраполяция","интерполяция","комбинаторика","аксиома","лемма","корреляция","деконструкция","репликация","квантификация","интерференция","флуктуация","суперпозиция","идемпотентность","асимптота","дифференциация","интеграция","дисперсия","конфабуляция","экспликация","импеданс","резистивность","индуктивность","аберрация","адиабатический","энтальпия","инвариант","аппроксимация","агрегация","аналогия","антиномия","апофеоз","конгруэнтность","конкатенация","идентификатор","криптография","стохастика","гомоморфизм","изоморфизм","биекция","диффузия","конденсация","сублимация","адсорбция","десорбция","термодинамика","катализ","ингибитор","рекурсия","итерация","регрессия","марковская цепь","градиент","дивергенция","лапласиан","кумулятивный","персистентный"],
    films_series:["Титаник","Аватар","Матрица","Интерстеллар","Начало","Темный рыцарь","Джокер","Властелин колец","Хоббит","Гарри Поттер","Звёздные войны","Мандалорец","Игра престолов","Дом дракона","Ведьмак","Шерлок","Доктор Хаус","Друзья","Теория большого взрыва","Офис","Побег из Шоушенка","Зелёная миля","Форрест Гамп","1+1","Ла-ла-ленд","Крестный отец","Таксист","Остров проклятых","Бойцовский клуб","Семь","Криминальное чтиво","Кил Билл","Однажды в Голливуде","Дюна","Бегущий по лезвию","Чужой","Хищник","Терминатор","Робокоп","Человек-паук","Железный человек","Мстители","Капитан Америка","Тор","Черная пантера","Стражи Галактики","Дэдпул","Локи","Во все тяжкие","Лучше звоните Солу","Наркос","Пикки Блайндерс","Викинги","Чёрное зеркало","Очень странные дела","Король Лев","Алладин","Холодное сердце","Тайна Коко","История игрушек","Рататуй","ВАЛЛ·И","Вверх","Головоломка","Моана","Пираты Карибского моря","Индиана Джонс","Миссия невыполнима","Джеймс Бонд","Шрек","Мадагаскар","Кунг-фу Панда","Как приручить дракона","Гладиатор","Троя","300 спартанцев","Храброе сердце","Марсианин","Выживший","Большой куш","Карты, деньги, два ствола","Достать ножи","Кингсман","Джентльмены","Аркейн","Кобра Кай","Сотня","Колесо времени","Фауда","Офис (UK)"],
    geography:["Европа","Азия","Африка","Северная Америка","Южная Америка","Австралия","Антарктида","Россия","Москва","Санкт-Петербург","США","Вашингтон","Нью-Йорк","Лос-Анджелес","Канада","Оттава","Торонто","Мексика","Бразилия","Рио-де-Жанейро","Аргентина","Буэнос-Айрес","Чили","Перу","Лима","Колумбия","Богота","Германия","Берлин","Франция","Париж","Испания","Мадрид","Италия","Рим","Милан","Венеция","Пиза","Греция","Афины","Великобритания","Лондон","Норвегия","Швеция","Стокгольм","Финляндия","Хельсинки","Дания","Копенгаген","Исландия","Рейкьявик","Польша","Варшава","Чехия","Прага","Австрия","Вена","Швейцария","Цюрих","Нидерланды","Амстердам","Бельгия","Брюссель","Португалия","Лиссабон","Турция","Стамбул","Анкара","Египет","Каир","Марокко","Рабат","Южная Африка","Кейптаун","Нигерия","Абуджа","Кения","Найроби","Эфиопия","Аддис-Абеба","Израиль","Иерусалим","Иордания","Амман","Саудовская Аравия","Эр-Рияд","ОАЭ","Дубай","Индия","Дели","Мумбаи","Непал","Катманду","Китай","Пекин","Великая китайская стена"],
    kids:["мяч","кукла","мишка","зайчик","солнышко","облако","радуга","снежинка","санки","варежки","шапка","шарф","машинка","паровоз","поезд","самолёт","ракета","лодка","парус","велосипед","самокат","качели","горка","карусель","зоопарк","цирк","парк","игрушка","конструктор","кубики","пазл","раскраска","фломастер","карандаш","кисточка","краски","пластилин","ножницы","клей","книжка","сказка","песня","танец","музыка","праздник","подарок","шарик","торт","свечи","печенье","конфета","шоколад","мороженое","яблоко","банан","груша","апельсин","клубника","вишня","арбуз","дыня","морковь","огурец","помидор","суп","каша","котёнок","щенок","хомяк","рыбка","черепаха","лягушка","утёнок","слон","жираф","лев","тигр","зебра","панда","домик","кроватка","подушка","одеяло","ванна","мыло","щётка","паста","полотенце","коляска","мама","папа","бабушка","дедушка","брат","сестра","друг","подруга","прятки","салочки"]
  };

  // Navigation
  const show = v => {
    ['viewMenu','viewQuickSetup','viewQuickGame','viewTeamSetup','viewTeamGame'].forEach(id=>$('#'+id).style.display='none');
    $('#'+v).style.display='flex';
    screen = v;
  };

  // Header buttons
  $('#btnBack').onclick = () => {
    if (screen==='viewQuickGame' || screen==='viewTeamGame'){
      if (!confirm('Выйти в меню? Текущая партия будет завершена.')) return;
    }
    show('viewMenu');
  };
  $('#btnHelp').onclick = () => {
    alert('КрокоМим — объясните слово жестами/мимикой. Кнопки: Угадано, Пропустить, Следующее; можно скрыть/показать слово и открыть значение на Википедии. Удачи!');
  };

  // Menu to setups
  $('#goQuick').onclick = () => show('viewQuickSetup');
  $('#goTeam').onclick = () => {
    ensureTeamsSeed();
    renderTeams();
    show('viewTeamSetup');
  };

  // Quick setup
  const qs = {
    dict: $('#quickDict'),
    customBox: $('#quickCustomBox'),
    customText: $('#quickCustomWords'),
    timerToggle: $('#quickTimerToggle'),
    time: 60,
    timeMinus: $('#quickTimeMinus'),
    timePlus: $('#quickTimePlus'),
    timeLabel: $('#quickTimeLabel'),
    start: $('#startQuick')
  };
  const upQuickTime = () => qs.timeLabel.textContent = qs.time+' c';
  upQuickTime();
  qs.timeMinus.onclick = () => { qs.time = Math.max(30, qs.time-30); upQuickTime(); };
  qs.timePlus.onclick = () => { qs.time += 30; upQuickTime(); };
  qs.dict.onchange = () => qs.customBox.style.display = (qs.dict.value==='custom')?'block':'none';

  // Quick game state
  let qWords=[], qIndex=0, qHide=false, qTimerId=null, qRemain=0, qHit=0, qMiss=0;

  const qUI = {
    word: $('#qWord'),
    hit: $('#qHit'), miss: $('#qMiss'),
    next: $('#qNext'), hitBtn: $('#qHitBtn'), skipBtn: $('#qSkipBtn'),
    hideBtn: $('#qHideBtn'), meaningBtn: $('#qMeaningBtn'),
    tBox: $('#qTimerBox'), tLabel: $('#qTimer')
  };

  const pad = n => String(n).padStart(2,'0');

  function startQuickGame(){
    // build words
    if (qs.dict.value==='custom'){
      const raw = qs.customText.value || '';
      qWords = raw.split(/[,\n]/).map(s=>s.trim()).filter(Boolean);
    }else{
      qWords = [...DICTS[qs.dict.value]];
    }
    if (qWords.length===0){ alert('Добавьте хотя бы одно слово'); return; }
    shuffle(qWords);
    qIndex=0; qHide=false; qHit=0; qMiss=0;
    qUI.hit.textContent = '0'; qUI.miss.textContent = '0';
    qUI.word.textContent = qWords[qIndex];
    qUI.hideBtn.textContent = 'Скрыть слово';

    // timer
    clearInterval(qTimerId); qTimerId=null;
    if (qs.timerToggle.checked){
      qUI.tBox.style.display='inline-flex';
      qRemain = qs.time;
      qUI.tLabel.textContent = `${pad(Math.floor(qRemain/60))}:${pad(qRemain%60)}`;
      qTimerId = setInterval(()=>{
        qRemain--;
        qUI.tLabel.textContent = `${pad(Math.floor(qRemain/60))}:${pad(qRemain%60)}`;
        if (qRemain<=0){ clearInterval(qTimerId); qTimerId=null; nextWord(); }
      },1000);
    }else{
      qUI.tBox.style.display='none';
    }
    show('viewQuickGame');
  }
  $('#startQuick').onclick = startQuickGame;

  function nextWord(){
    qIndex = (qIndex+1) % qWords.length;
    qHide=false;
    qUI.word.textContent = qWords[qIndex];
    qUI.hideBtn.textContent = 'Скрыть слово';
  }

  qUI.next.onclick = nextWord;
  qUI.hitBtn.onclick = ()=>{ qHit++; qUI.hit.textContent=qHit; nextWord(); };
  qUI.skipBtn.onclick = ()=>{ qMiss++; qUI.miss.textContent=qMiss; nextWord(); };
  qUI.hideBtn.onclick = ()=>{
    qHide = !qHide;
    qUI.word.textContent = qHide ? '•••' : qWords[qIndex];
    qUI.hideBtn.textContent = qHide ? 'Показать слово' : 'Скрыть слово';
  };
  qUI.meaningBtn.onclick = ()=> window.open('https://ru.wikipedia.org/wiki/'+encodeURIComponent(qWords[qIndex]), '_blank');

  // Team setup & game
  let teams = [];
  function ensureTeamsSeed(){
    if (teams.length===0){
      teams = [
        {name:'Команда 1', points:0, hit:0, miss:0},
        {name:'Команда 2', points:0, hit:0, miss:0},
      ];
    }
  }
  const teamList = $('#teamList');
  function renderTeams(){
    teamList.innerHTML='';
    teams.forEach((t, i)=>{
      const card=document.createElement('div');
      card.className='section';
      card.style.minWidth='220px';
      card.innerHTML = `
        <div class="stack">
          <div class="row" style="justify-content:space-between;align-items:center">
            <strong>${t.name}</strong>
            <button class="btn ghost" data-i="${i}" data-action="del">Удалить</button>
          </div>
          <input class="input" value="${t.name}" data-i="${i}" data-action="name" />
          <div class="muted">Картинка: пресет (позже)</div>
        </div>`;
      teamList.appendChild(card);
    });
    const actions = teamList.querySelectorAll('[data-action]');
    actions.forEach(el=>{
      el.onclick = (e)=>{
        const i = +el.getAttribute('data-i');
        const act = el.getAttribute('data-action');
        if (act==='del'){ if (teams.length>2){ teams.splice(i,1); renderTeams(); } else alert('Нужно минимум 2 команды'); }
      };
      if (el.tagName==='INPUT' && el.getAttribute('data-action')==='name'){
        el.oninput = ()=>{ teams[+el.getAttribute('data-i')].name = el.value.trim() || ('Команда '+(+el.getAttribute('data-i')+1)); };
      }
    });
  }
  $('#teamAdd').onclick = ()=>{ teams.push({name:'Команда '+(teams.length+1), points:0, hit:0, miss:0}); renderTeams(); };

  const ts = {
    dict: $('#teamDict'),
    customBox: $('#teamCustomBox'),
    customText: $('#teamCustomWords'),
    timerToggle: $('#teamTimerToggle'),
    time: 60,
    timeMinus: $('#teamTimeMinus'),
    timePlus: $('#teamTimePlus'),
    timeLabel: $('#teamTimeLabel'),
    pts: 10, ptsMinus: $('#ptsMinus'), ptsPlus: $('#ptsPlus'), ptsLabel: $('#ptsLabel')
  };
  const upTeamTime = () => ts.timeLabel.textContent = ts.time+' c';
  const upPts = () => ts.ptsLabel.textContent = ts.pts;
  upTeamTime(); upPts();
  ts.timeMinus.onclick = ()=>{ ts.time = Math.max(30, ts.time-30); upTeamTime(); };
  ts.timePlus.onclick = ()=>{ ts.time += 30; upTeamTime(); };
  ts.ptsMinus.onclick = ()=>{ ts.pts = Math.max(1, ts.pts-1); upPts(); };
  ts.ptsPlus.onclick = ()=>{ ts.pts += 1; upPts(); };
  ts.dict.onchange = ()=> ts.customBox.style.display = (ts.dict.value==='custom')?'block':'none';

  // Team game state
  let tWords=[], tIndex=0, tHide=false, tTimerId=null, tRemain=0, turn=0;

  const tUI = {
    word: $('#tWord'),
    turnName: $('#turnTeamName'),
    tBox: $('#tTimerBox'), tLabel: $('#tTimer'),
    table: $('#scoreTable'),
    next: $('#tNext'), hit: $('#tHitBtn'), skip: $('#tSkipBtn'),
    hideBtn: $('#tHideBtn'), meaning: $('#tMeaningBtn')
  };

  function renderScore(){
    tUI.table.innerHTML='';
    teams.forEach(t=>{
      const row=document.createElement('div');
      row.className='row';
      row.innerHTML = `
        <div class="chip" style="min-width:140px">${t.name}</div>
        <div class="chip">Угадано: ${t.hit}</div>
        <div class="chip">Пропущено: ${t.miss}</div>
        <div class="chip">Очки: ${t.points}</div>`;
      tUI.table.appendChild(row);
    });
  }

  function startTeamGame(){
    if (teams.length<2){ alert('Нужно минимум 2 команды'); return; }
    // build words
    if (ts.dict.value==='custom'){
      const raw = ts.customText.value || '';
      tWords = raw.split(/[,\n]/).map(s=>s.trim()).filter(Boolean);
    }else{
      tWords = [...DICTS[ts.dict.value]];
    }
    if (tWords.length===0){ alert('Добавьте хотя бы одно слово'); return; }
    shuffle(tWords);
    teams = teams.map(t=>({name:t.name, points:0, hit:0, miss:0}));
    tIndex=0; tHide=false; turn=0;
    tUI.word.textContent = tWords[tIndex];
    tUI.hideBtn.textContent = 'Скрыть слово';
    tUI.turnName.textContent = teams[turn].name;
    renderScore();

    clearInterval(tTimerId); tTimerId=null;
    if (ts.timerToggle.checked){
      tUI.tBox.style.display='inline-flex';
      tRemain = ts.time;
      tUI.tLabel.textContent = `${pad(Math.floor(tRemain/60))}:${pad(tRemain%60)}`;
      tTimerId = setInterval(()=>{
        tRemain--;
        tUI.tLabel.textContent = `${pad(Math.floor(tRemain/60))}:${pad(tRemain%60)}`;
        if (tRemain<=0){ clearInterval(tTimerId); tTimerId=null; nextTurn(); }
      },1000);
    }else{
      tUI.tBox.style.display='none';
    }
    show('viewTeamGame');
  }
  $('#startTeam').onclick = startTeamGame;

  function nextTurn(){
    turn = (turn+1) % teams.length;
    tUI.turnName.textContent = teams[turn].name;
    nextTeamWord();
    if (ts.timerToggle.checked){
      clearInterval(tTimerId); tRemain = ts.time;
      tUI.tLabel.textContent = `${pad(Math.floor(tRemain/60))}:${pad(tRemain%60)}`;
      tTimerId = setInterval(()=>{
        tRemain--;
        tUI.tLabel.textContent = `${pad(Math.floor(tRemain/60))}:${pad(tRemain%60)}`;
        if (tRemain<=0){ clearInterval(tTimerId); tTimerId=null; nextTurn(); }
      },1000);
    }
  }
  function nextTeamWord(){
    tIndex = (tIndex+1) % tWords.length;
    tHide=false;
    tUI.word.textContent = tWords[tIndex];
    tUI.hideBtn.textContent = 'Скрыть слово';
  }

  tUI.next.onclick = nextTeamWord;
  tUI.hideBtn.onclick = ()=>{
    tHide = !tHide;
    tUI.word.textContent = tHide ? '•••' : tWords[tIndex];
    tUI.hideBtn.textContent = tHide ? 'Показать слово' : 'Скрыть слово';
  };
  tUI.meaning.onclick = ()=> window.open('https://ru.wikipedia.org/wiki/'+encodeURIComponent(tWords[tIndex]), '_blank');

  tUI.hit.onclick = ()=>{
    teams[turn].hit++; teams[turn].points++;
    renderScore();
    if (teams[turn].points >= ts.pts){
      alert('Победа: ' + teams[turn].name);
      show('viewMenu');
      return;
    }
    nextTurn();
  };
  tUI.skip.onclick = ()=>{
    teams[turn].miss++; teams[turn].points--;
    renderScore();
    nextTurn();
  };

  // Helpers
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]] } return a }

  // initial
  show('viewMenu');
</script>
</body>
</html>
